<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Feature flags - A successful architecture - Jeroen Mols</title>
<meta name="description" content="Now that we know how feature flags can help us release faster, it’s time to dive into the actual implementation details. How can we easily define feature flags? How to configure them both locally as remotely? And use them in our testing?">


  <meta name="author" content="Jeroen Mols">
  
  <meta property="article:author" content="Jeroen Mols">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en">
<meta property="og:site_name" content="Jeroen Mols">
<meta property="og:title" content="Feature flags - A successful architecture">
<meta property="og:url" content="https://jeroenmols.com/blog/2019/09/12/featureflagsarchitecture/">


  <meta property="og:description" content="Now that we know how feature flags can help us release faster, it’s time to dive into the actual implementation details. How can we easily define feature flags? How to configure them both locally as remotely? And use them in our testing?">



  <meta property="og:image" content="https://jeroenmols.com/img/blog/featureflagarchitecture/featureflagarchitecture.jpg">



  <meta name="twitter:site" content="@molsjeroen">
  <meta name="twitter:title" content="Feature flags - A successful architecture">
  <meta name="twitter:description" content="Now that we know how feature flags can help us release faster, it’s time to dive into the actual implementation details. How can we easily define feature flags? How to configure them both locally as remotely? And use them in our testing?">
  <meta name="twitter:url" content="https://jeroenmols.com/blog/2019/09/12/featureflagsarchitecture/">

  
    <meta name="twitter:card" content="summary">
    
      <meta name="twitter:image" content="https://jeroenmols.com/img/blog/featureflagarchitecture/featureflagarchitecture.jpg">
    
  

  



  <meta property="article:published_time" content="2019-09-12T00:00:00+02:00">





  

  


<link rel="canonical" href="https://jeroenmols.com/blog/2019/09/12/featureflagsarchitecture/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Jeroen Mols",
      "url": "https://jeroenmols.com/",
      "sameAs": ["https://twitter.com/molsjeroen","https://www.linkedin.com/in/jeroenmols/","https://plus.google.com/+JeroenMols","https://github.com/JeroenMols","https://speakerdeck.com/jeroenmols","https://stackoverflow.com/users/2771851/jmols"]
    
  }
</script>


  <meta name="google-site-verification" content="8E8HUpExgyNFdLuFMWmkSUl08gISnOF3UWexA55aNrk" />






<!-- end _includes/seo.html -->

<script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
<script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
<script>
$(document).ready(function(){
	$('.ga-link').on('click', function(){
		if (typeof(ga)!=="undefined"){
			ga('send',{
				hitType: 'event',
				eventCategory: 'Outbound link',
				eventAction: 'click',
				eventLabel: event.target.href
			});
	  	}
	});
})	;
</script>

<meta name="theme-color" content="#3d405b">

<link href="atom.xml" type="application/atom+xml" rel="alternate" title="Jeroen Mols Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<meta name="author" content="Jeroen Mols">
<link href="https://twitter.com/molsjeroen" rel="me">
<link href="https://androiddev.social/@jeroenmols" rel="me">
<link href="https://github.com/jeroenmols" rel="me">
<link href="https://www.linkedin.com/in/jeroenmols/" rel="me">
<link href="https://stackoverflow.com/users/2771851/jeroen-mols" rel="me">



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Jeroen Mols
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/blog/">Blog</a>
            </li><li class="masthead__menu-item">
              <a href="/speaking/">Speaking</a>
            </li><li class="masthead__menu-item">
              <a href="/hireme/">Hire me</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle Menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/img/profile.jpg" alt="Jeroen Mols" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Jeroen Mols</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Software developer at Plaid and Google Developer Expert</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Flanders, Belgium</span>
        </li>
      

      
        
          
            <li><a href="https://twitter.com/molsjeroen" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
            <li><a href="https://androiddev.social/web/@Jeroenmols" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-mastodon" aria-hidden="true"></i><span class="label">Mastodon</span></a></li>
          
        
          
            <li><a href="https://github.com/jeroenmols" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/jeroenmols/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">Linkedin</span></a></li>
          
        
          
            <li><a href="https://speakerdeck.com/jeroenmols" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-speaker-deck" aria-hidden="true"></i><span class="label">Speakerdeck</span></a></li>
          
        
          
            <li><a href="https://stackoverflow.com/users/2771851/jeroen-mols" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-stack-overflow" aria-hidden="true"></i><span class="label">Stackoverflow</span></a></li>
          
        
          
            <li><a href="https://www.youtube.com/channel/UC34Vt1lo8T15_rgc3e3Jsew" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-youtube" aria-hidden="true"></i><span class="label">YouTube</span></a></li>
          
        
          
            <li><a href="mailto:info@jeroenmols.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="Feature flags - A successful architecture">
    <meta itemprop="description" content="Now that we know how feature flags can help us release faster, it’s time to dive into the actual implementation details. How can we easily define feature flags? How to configure them both locally as remotely? And use them in our testing?">
    <meta itemprop="datePublished" content="September 12, 2019">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 class="page__title" itemprop="headline">Feature flags - A successful architecture
</h1>
          <p class="page__meta"><i class="fa fa-fw fa-calendar" aria-hidden="true"></i>  12 Sep 2019</p>

          
            <img src="/img/blog/featureflagarchitecture/featureflagarchitecture.jpg" alt="Feature flags - A successful architecture" title="Background photo by Miguel Á. Padriñán (from Pexels), https://www.pexels.com/photo/defocused-image-of-lights-255379/, cropped with app screenshot on top">
          

          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  12 minute read

</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>Now that we know how feature flags can help us release faster, it’s time to dive into the actual implementation details. How can we easily define feature flags? How to configure them both locally as remotely? And use them in our testing?</p>

<p>This post will present a simple, powerful architecture to manage feature flags and comes with a <a href="https://github.com/JeroenMols/FeatureFlagExample">full example on Github</a>.</p>

<blockquote>
  <p>This blog post is part of a series on feature flags:</p>
  <ul>
    <li>Part 1: <a href="/blog/2019/08/13/featureflags/">Why you should care</a></li>
    <li>Part 2: <a href="/blog/2019/08/20/featureflagshowtouse/">How to use</a></li>
    <li>Part 3: <a href="/blog/2019/09/12/featureflagsarchitecture/">A successful architecture</a></li>
  </ul>
</blockquote>

<h2 id="creating-new-feature-flags">Creating new feature flags</h2>
<p>As discussed in <a href="/blog/2019/08/13/featureflags/">part 1</a>, the easier it is to add feature flags, the more likely developers will use the system. At its core a <code class="language-plaintext highlighter-rouge">Feature</code> is something very simple:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">interface</span> <span class="nc">Feature</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">key</span><span class="p">:</span> <span class="nc">String</span>
    <span class="kd">val</span> <span class="py">title</span><span class="p">:</span> <span class="nc">String</span>
    <span class="kd">val</span> <span class="py">explanation</span><span class="p">:</span> <span class="nc">String</span>
    <span class="kd">val</span> <span class="py">defaultValue</span><span class="p">:</span> <span class="nc">Boolean</span>
<span class="p">}</span>
</code></pre></div></div>

<p>It needs to have a unique <code class="language-plaintext highlighter-rouge">key</code> to reference it on your remote feature flagging tool. A <code class="language-plaintext highlighter-rouge">title</code> and <code class="language-plaintext highlighter-rouge">description</code> to help understand what it is all about. And optionally a default value, which is handy if you’re using both <code class="language-plaintext highlighter-rouge">FeatureFlags</code> and <code class="language-plaintext highlighter-rouge">TestSettings</code>.</p>

<p>This interface can now be implemented by both a <code class="language-plaintext highlighter-rouge">FeatureFlag</code> and <code class="language-plaintext highlighter-rouge">TestSetting</code> enum:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">enum</span> <span class="kd">class</span> <span class="nc">FeatureFlag</span><span class="p">(</span>
        <span class="k">override</span> <span class="kd">val</span> <span class="py">key</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
        <span class="k">override</span> <span class="kd">val</span> <span class="py">title</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
        <span class="k">override</span> <span class="kd">val</span> <span class="py">explanation</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
        <span class="k">override</span> <span class="kd">val</span> <span class="py">defaultValue</span><span class="p">:</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="k">true</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">Feature</span> <span class="p">{</span>
    <span class="nc">DARK_MODE</span><span class="p">(</span><span class="s">"feature.darkmode"</span><span class="p">,</span> <span class="s">"Dark theme"</span><span class="p">,</span> <span class="s">"Enabled dark mode"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">enum</span> <span class="kd">class</span> <span class="nc">TestSetting</span><span class="p">(</span>
        <span class="k">override</span> <span class="kd">val</span> <span class="py">key</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
        <span class="k">override</span> <span class="kd">val</span> <span class="py">title</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
        <span class="k">override</span> <span class="kd">val</span> <span class="py">explanation</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
        <span class="k">override</span> <span class="kd">val</span> <span class="py">defaultValue</span><span class="p">:</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="k">false</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">Feature</span> <span class="p">{</span>
    <span class="nc">USE_DEVELOP_PORTAL</span><span class="p">(</span><span class="s">"testsetting.usedevelopportal"</span><span class="p">,</span> <span class="s">"Development portal"</span><span class="p">,</span> <span class="s">"Use developer REST endpoint"</span><span class="p">),</span>
    <span class="nc">DEBUG_LOGGING</span><span class="p">(</span><span class="s">"testsetting.debuglogging"</span><span class="p">,</span> <span class="s">"Enable logging"</span><span class="p">,</span> <span class="s">"Print all app logging to console"</span><span class="p">,</span> <span class="n">defaultValue</span> <span class="p">=</span> <span class="k">true</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Note how a <code class="language-plaintext highlighter-rouge">FeatureFlag</code> is on by default so that it is immediately visible in developer builds, whereas <code class="language-plaintext highlighter-rouge">TestSettings</code> are off by default as they usually put the app in a specific condition to help with testing.</p>

<p>Both <code class="language-plaintext highlighter-rouge">FeatureFlag</code> and <code class="language-plaintext highlighter-rouge">TestSetting</code> are enums so that the Kotlin compiler can force you to handle each case explicitly in a <code class="language-plaintext highlighter-rouge">when</code> statement. At the same time, they are not sealed classes, because we need to be able to enumerate all items, later on, to automatically generate a UI from it. (There is no way to ask a sealed class to list all it’s subclasses)</p>

<blockquote>
  <p>Mission accomplished: adding a new <code class="language-plaintext highlighter-rouge">FeatureFlag</code> / <code class="language-plaintext highlighter-rouge">TestSetting</code> is as easy as adding a one-liner!</p>
  <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">AWESOME</span><span class="p">(</span><span class="s">"feature.awesome"</span><span class="p">,</span> <span class="s">"Awesome"</span><span class="p">,</span> <span class="s">"Does something awesome"</span><span class="p">)</span>
</code></pre></div>  </div>
</blockquote>

<h2 id="consuming-feature-flags">Consuming feature flags</h2>
<p>Next, our app needs to be able to read out what value (true/false) a <code class="language-plaintext highlighter-rouge">Feature</code> is currently set to. This can be done by requesting one of the <code class="language-plaintext highlighter-rouge">FeatureFlagProviders</code> for the current value:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">interface</span> <span class="nc">FeatureFlagProvider</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">priority</span><span class="p">:</span> <span class="nc">Int</span>
    <span class="k">fun</span> <span class="nf">isFeatureEnabled</span><span class="p">(</span><span class="n">feature</span><span class="p">:</span> <span class="nc">Feature</span><span class="p">):</span> <span class="nc">Boolean</span>
    <span class="k">fun</span> <span class="nf">hasFeature</span><span class="p">(</span><span class="n">feature</span><span class="p">:</span> <span class="nc">Feature</span><span class="p">):</span> <span class="nc">Boolean</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This interface will have several implementations with different priorities attached to it so that they can override each other. (more on that later)</p>

<p>Note how implementations don’t need to provide a value for every <code class="language-plaintext highlighter-rouge">Feature</code> thanks to the <code class="language-plaintext highlighter-rouge">hasFeature()</code> method! This has two benefits:</p>

<ul>
  <li>you can prevent accidentally relying on build-in defaults of the feature flag tool you are using by requiring an explicit opt-in for that tool (e.g. Firebase remote config returns false when it doesn’t have a value)</li>
  <li>you can have a chain of providers (e.g. we can have a feature flag that is only locally available, not remotely).</li>
</ul>

<p>The <code class="language-plaintext highlighter-rouge">RuntimeBehavior</code> links all <code class="language-plaintext highlighter-rouge">FeatureFlagProviders</code> together and exposes the API that should be used from within the application:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">object</span> <span class="nc">RuntimeBehavior</span> <span class="p">{</span>

    <span class="nd">@VisibleForTesting</span>
    <span class="k">internal</span> <span class="kd">val</span> <span class="py">providers</span> <span class="p">=</span> <span class="nc">CopyOnWriteArrayList</span><span class="p">&lt;</span><span class="nc">FeatureFlagProvider</span><span class="p">&gt;()</span>

    <span class="nd">@JvmStatic</span>
    <span class="k">fun</span> <span class="nf">isFeatureEnabled</span><span class="p">(</span><span class="n">feature</span><span class="p">:</span> <span class="nc">Feature</span><span class="p">):</span> <span class="nc">Boolean</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">providers</span><span class="p">.</span><span class="nf">filter</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">hasFeature</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span> <span class="p">}</span>
                <span class="p">.</span><span class="nf">sortedBy</span><span class="p">(</span><span class="nc">FeatureFlagProvider</span><span class="o">::</span><span class="n">priority</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">firstOrNull</span><span class="p">()</span>
                <span class="o">?.</span><span class="nf">isFeatureEnabled</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
                <span class="o">?:</span> <span class="n">feature</span><span class="p">.</span><span class="n">defaultValue</span>
    <span class="p">}</span>

    <span class="nd">@JvmStatic</span>
    <span class="k">fun</span> <span class="nf">addProvider</span><span class="p">(</span><span class="n">provider</span><span class="p">:</span> <span class="nc">FeatureFlagProvider</span><span class="p">)</span> <span class="p">=</span> <span class="n">providers</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">provider</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Note how it takes all <code class="language-plaintext highlighter-rouge">FeatureFlagProviders</code>, removes those that don’t provide a value for the <code class="language-plaintext highlighter-rouge">Feature</code> and then takes the value of the highest priority provider. If no one provides a value, the default value is returned.</p>

<p>Thanks to all of this we can now call from anywhere in the app:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="nc">RuntimeBehavior</span><span class="p">.</span><span class="nf">isFeatureEnabled</span><span class="p">(</span><span class="nc">FeatureFlag</span><span class="p">.</span><span class="nc">DARK_MODE</span><span class="p">))</span> <span class="p">{</span>
  <span class="c1">// set dark theme</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="c1">// set light them</span>
<span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p>Consuming <code class="language-plaintext highlighter-rouge">FeatureFlag</code>/<code class="language-plaintext highlighter-rouge">TestSetting</code> is as easy as asking the <code class="language-plaintext highlighter-rouge">RuntimeBehavior</code></p>
  <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="nf">isFeatureEnabled</span><span class="p">(</span><span class="nc">AWESOME</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// code here</span>
<span class="p">}</span>
</code></pre></div>  </div>
</blockquote>

<h2 id="providing-feature-flag-values">Providing feature flag values</h2>
<p>Let’s have a look at the several different <code class="language-plaintext highlighter-rouge">FeatureFlagProviders</code>, why we need them and how they work.</p>

<h3 id="runtimefeatureflagprovider">RuntimeFeatureFlagProvider</h3>
<p>This provider only exists in the debug version of the app and allows to dynamically turn features on or off.</p>

<p>It does this by keeping a <code class="language-plaintext highlighter-rouge">SharedPreferences</code> internally where it automatically stores a value for each <code class="language-plaintext highlighter-rouge">Feature</code> using its key.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">RuntimeFeatureFlagProvider</span> <span class="p">:</span> <span class="nc">FeatureFlagProvider</span> <span class="p">{</span>

    <span class="k">private</span> <span class="kd">val</span> <span class="py">preferences</span><span class="p">:</span> <span class="nc">SharedPreferences</span>

    <span class="k">override</span> <span class="kd">val</span> <span class="py">priority</span> <span class="p">=</span> <span class="nc">MEDIUM_PRIORITY</span>

    <span class="k">constructor</span><span class="p">(</span><span class="n">applicationContext</span><span class="p">:</span> <span class="nc">Context</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">preferences</span> <span class="p">=</span> <span class="n">applicationContext</span><span class="p">.</span><span class="nf">getSharedPreferences</span><span class="p">(</span><span class="s">"runtime.featureflags"</span><span class="p">,</span> <span class="nc">Context</span><span class="p">.</span><span class="nc">MODE_PRIVATE</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">isFeatureEnabled</span><span class="p">(</span><span class="n">feature</span><span class="p">:</span> <span class="nc">Feature</span><span class="p">):</span> <span class="nc">Boolean</span> <span class="p">=</span>
        <span class="n">preferences</span><span class="p">.</span><span class="nf">getBoolean</span><span class="p">(</span><span class="n">feature</span><span class="p">.</span><span class="n">key</span><span class="p">,</span> <span class="n">feature</span><span class="p">.</span><span class="n">defaultValue</span><span class="p">)</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">hasFeature</span><span class="p">(</span><span class="n">feature</span><span class="p">:</span> <span class="nc">Feature</span><span class="p">):</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="k">true</span>

    <span class="k">fun</span> <span class="nf">setFeatureEnabled</span><span class="p">(</span><span class="n">feature</span><span class="p">:</span> <span class="nc">Feature</span><span class="p">,</span> <span class="n">enabled</span><span class="p">:</span> <span class="nc">Boolean</span><span class="p">)</span> <span class="p">=</span>
        <span class="n">preferences</span><span class="p">.</span><span class="nf">edit</span><span class="p">().</span><span class="nf">putBoolean</span><span class="p">(</span><span class="n">feature</span><span class="p">.</span><span class="n">key</span><span class="p">,</span> <span class="n">enabled</span><span class="p">).</span><span class="nf">apply</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Notice how this provider has a public API <code class="language-plaintext highlighter-rouge">setFeatureEnabled</code> to change the current value of a <code class="language-plaintext highlighter-rouge">Feature</code> and how every <code class="language-plaintext highlighter-rouge">Feature</code> is always configurable at runtime. (i.e. <code class="language-plaintext highlighter-rouge">hasFeature()</code> returns true for every feature)</p>

<blockquote>
  <p>The <code class="language-plaintext highlighter-rouge">RuntimeFeatureFlagProvider</code> allows to locally turn any <code class="language-plaintext highlighter-rouge">FeatureFlag</code>/<code class="language-plaintext highlighter-rouge">TestSetting</code> on or off.</p>
</blockquote>

<h3 id="storefeatureflagprovider">StoreFeatureFlagProvider</h3>
<p>This provider only exists in the release version of the app and defines the baseline of what <code class="language-plaintext highlighter-rouge">Features</code> are on or off. <code class="language-plaintext highlighter-rouge">TestSettings</code> aren’t exposed in the release version of an app and are always off.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">StoreFeatureFlagProvider</span> <span class="p">:</span> <span class="nc">FeatureFlagProvider</span> <span class="p">{</span>

    <span class="k">override</span> <span class="kd">val</span> <span class="py">priority</span> <span class="p">=</span> <span class="nc">MIN_PRIORITY</span>

    <span class="nd">@Suppress</span><span class="p">(</span><span class="s">"ComplexMethod"</span><span class="p">)</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">isFeatureEnabled</span><span class="p">(</span><span class="n">feature</span><span class="p">:</span> <span class="nc">Feature</span><span class="p">):</span> <span class="nc">Boolean</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">feature</span> <span class="k">is</span> <span class="nc">FeatureFlag</span><span class="p">)</span> <span class="p">{</span>
           <span class="c1">// No "else" branch here -&gt; choosing the default</span>
           <span class="c1">// option for release must be an explicit choice</span>
            <span class="k">return</span> <span class="k">when</span> <span class="p">(</span><span class="n">feature</span><span class="p">)</span> <span class="p">{</span>
                <span class="nc">DARK_MODE</span> <span class="p">-&gt;</span> <span class="k">false</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// TestSettings should never be shipped to users</span>
            <span class="k">return</span> <span class="k">when</span> <span class="p">(</span><span class="n">feature</span> <span class="k">as</span> <span class="nc">TestSetting</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">else</span> <span class="p">-&gt;</span> <span class="k">false</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">hasFeature</span><span class="p">(</span><span class="n">feature</span><span class="p">:</span> <span class="nc">Feature</span><span class="p">):</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="k">true</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Notice how you must provide an explicit value for every feature toggle! This is because you never want to accidentally ship an unfinished feature to users. Non gradual rollout of a feature requires an explicit change to the <code class="language-plaintext highlighter-rouge">StoreFeatureFlagProvider</code>.</p>

<p>Finally, this makes it very easy to check what features are on or off in any given app release. And since all of this is just Kotlin code, it’s easy to write a script to generate a release report with what feature toggles exist and their value for that app version.</p>

<blockquote>
  <p>The <code class="language-plaintext highlighter-rouge">StoreFeatureFlagProvider</code> defines for every <code class="language-plaintext highlighter-rouge">Feature</code> whether it is on or off in the release build</p>
</blockquote>

<h3 id="firebasefeatureflagprovider">FirebaseFeatureFlagProvider</h3>
<p>One of the most interesting things about <code class="language-plaintext highlighter-rouge">FeatureFlags</code> is that you can gradually roll them out using a remote feature flagging tool. We’ll look at <a href="https://firebase.google.com/docs/remote-config">Firebase Remote Config</a> as an example, but this architecture supports any tool.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">FirebaseFeatureFlagProvider</span><span class="p">(</span><span class="k">private</span> <span class="kd">val</span> <span class="py">isDevModeEnabled</span><span class="p">:</span> <span class="nc">Boolean</span><span class="p">)</span> <span class="p">:</span> <span class="nc">FeatureFlagProvider</span> <span class="p">{</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">remoteConfig</span><span class="p">:</span> <span class="nc">FirebaseRemoteConfig</span> <span class="p">=</span> <span class="nc">FirebaseRemoteConfig</span><span class="p">.</span><span class="nf">getInstance</span><span class="p">()</span>

    <span class="nf">init</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">configSettings</span> <span class="p">=</span> <span class="nc">FirebaseRemoteConfigSettings</span><span class="p">.</span><span class="nc">Builder</span><span class="p">().</span><span class="nf">setDeveloperModeEnabled</span><span class="p">(</span><span class="n">isDevModeEnabled</span><span class="p">).</span><span class="nf">build</span><span class="p">()</span>
        <span class="n">remoteConfig</span><span class="p">.</span><span class="nf">setConfigSettings</span><span class="p">(</span><span class="n">configSettings</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="kd">val</span> <span class="py">priority</span><span class="p">:</span> <span class="nc">Int</span> <span class="p">=</span> <span class="nc">MAX_PRIORITY</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">isFeatureEnabled</span><span class="p">(</span><span class="n">feature</span><span class="p">:</span> <span class="nc">Feature</span><span class="p">):</span> <span class="nc">Boolean</span> <span class="p">=</span>
        <span class="n">remoteConfig</span><span class="p">.</span><span class="nf">getBoolean</span><span class="p">(</span><span class="n">feature</span><span class="p">.</span><span class="n">key</span><span class="p">)</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">hasFeature</span><span class="p">(</span><span class="n">feature</span><span class="p">:</span> <span class="nc">Feature</span><span class="p">):</span> <span class="nc">Boolean</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">when</span> <span class="p">(</span><span class="n">feature</span><span class="p">)</span> <span class="p">{</span>
            <span class="nc">FeatureFlag</span><span class="p">.</span><span class="nc">DARK_MODE</span> <span class="p">-&gt;</span> <span class="k">true</span>
            <span class="k">else</span> <span class="p">-&gt;</span> <span class="k">false</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The most important thing to note here is that the <code class="language-plaintext highlighter-rouge">FirebaseFeatureFlagProvider</code> has the maximum priority, which means it takes precedence over any other <code class="language-plaintext highlighter-rouge">FeatureFlagProvider</code>.</p>

<p>However, it doesn’t provide a value for all feature flags! That is because a <code class="language-plaintext highlighter-rouge">FeatureFlag</code> should only be remotely toggled once development for the feature is done. We don’t want anyone accidentally expose an unfinished/broken feature to users from the feature flag tool console.</p>

<p>Typically the lifecycle of a <code class="language-plaintext highlighter-rouge">FeatureFlag</code> is:</p>

<ul>
  <li>Development started on new feature -&gt; <code class="language-plaintext highlighter-rouge">FeatureFlag</code> added</li>
  <li>While development ongoing -&gt; <code class="language-plaintext highlighter-rouge">FeatureFlag</code> locally available</li>
  <li>Development done
    <ul>
      <li>Either toggle <code class="language-plaintext highlighter-rouge">FeatureFlag</code> in <code class="language-plaintext highlighter-rouge">StoreFeatureFlagProvider</code> and roll it out to all users at once. (typically if you have a marketing campaign attached to the feature)</li>
      <li>Or add the <code class="language-plaintext highlighter-rouge">FeatureFlag</code> to the <code class="language-plaintext highlighter-rouge">FirebaseFeatureFlagProvider</code> and gradually roll it out</li>
    </ul>
  </li>
  <li>Rollout done -&gt; remove <code class="language-plaintext highlighter-rouge">FeatureFlag</code> and clean up unused code</li>
</ul>

<blockquote>
  <p>The <code class="language-plaintext highlighter-rouge">&lt;tool name&gt; - FeatureFlagProvider</code> allows to gradually roll out finished features to users</p>
</blockquote>

<h3 id="how-the-different-providers-work-together">How the different providers work together</h3>
<p>Whenever the <code class="language-plaintext highlighter-rouge">RuntimeBehavior</code> is initialized, it will initialize all providers:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">object</span> <span class="nc">RuntimeBehavior</span> <span class="p">{</span>
    <span class="o">..</span><span class="p">.</span>

    <span class="nd">@JvmStatic</span>
    <span class="k">fun</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="nc">Context</span><span class="p">,</span> <span class="n">isDebugBuild</span><span class="p">:</span> <span class="nc">Boolean</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">isDebugBuild</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">val</span> <span class="py">runtimeFeatureFlagProvider</span> <span class="p">=</span> <span class="nc">RuntimeFeatureFlagProvider</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
            <span class="nf">addProvider</span><span class="p">(</span><span class="nc">RuntimeFeatureFlagProvider</span><span class="p">(</span><span class="n">context</span><span class="p">))</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">runtimeFeatureFlagProvider</span><span class="p">.</span><span class="nf">isFeatureEnabled</span><span class="p">(</span><span class="nc">TestSetting</span><span class="p">.</span><span class="nc">DEBUG_FIREBASE</span><span class="p">))</span> <span class="p">{</span>
                <span class="nf">addProvider</span><span class="p">(</span><span class="nc">FirebaseFeatureFlagProvider</span><span class="p">(</span><span class="k">true</span><span class="p">))</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">addProvider</span><span class="p">(</span><span class="nc">StoreFeatureFlagProvider</span><span class="p">())</span>
            <span class="nf">addProvider</span><span class="p">(</span><span class="nc">FirebaseFeatureFlagProvider</span><span class="p">(</span><span class="k">false</span><span class="p">))</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>For debug builds, usually only the <code class="language-plaintext highlighter-rouge">RuntimeFeatureFlagProvider</code> is enabled so feature flags can be toggled from the test settings screen (more on that next).</p>

<p>But you can even enable the <code class="language-plaintext highlighter-rouge">FirebaseFeatureFlagProvider</code> in the debug build. This allows to also easily test the remote feature flag tool.</p>

<p>In release, however, the <code class="language-plaintext highlighter-rouge">FeatureFlag</code> value is taken from Firebase when the <code class="language-plaintext highlighter-rouge">FeatureFlag</code> was made remotely available (using <code class="language-plaintext highlighter-rouge">hasFeature()</code> in <code class="language-plaintext highlighter-rouge">FirebaseFeatureFlagProvider</code>). If not, the value from <code class="language-plaintext highlighter-rouge">StoreFeatureFlagProvider</code> is used.</p>

<p><img src="https://jeroenmols.com/img/blog/featureflagarchitecture/featureflagprovider_priority.png" alt="Different FeatureFlagProviders and their priority for every build type" /></p>

<h2 id="showing-the-flags-in-a-ui">Showing the flags in a UI</h2>
<p>Within the developer version of our app, we want to be able to both see the status of all <code class="language-plaintext highlighter-rouge">Features</code> and <code class="language-plaintext highlighter-rouge">TestSettings</code> and also toggle each one on or off. Basically, we want to automatically generate a UI like this:</p>

<p><img src="https://jeroenmols.com/img/blog/featureflagarchitecture/testsettings.png" alt="Test settings activity to dynamically configure behavior in the app" /></p>

<p>To show all of the <code class="language-plaintext highlighter-rouge">Features</code>, we can simply define a custom <code class="language-plaintext highlighter-rouge">RecyclerView</code> that displays an <code class="language-plaintext highlighter-rouge">Array</code> of <code class="language-plaintext highlighter-rouge">Features</code>.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="kd">class</span> <span class="nc">FeatureFlagAdapter</span><span class="p">&lt;</span><span class="nc">T</span> <span class="p">:</span> <span class="nc">Feature</span><span class="p">&gt;(</span>
    <span class="kd">val</span> <span class="py">items</span><span class="p">:</span> <span class="nc">Array</span><span class="p">&lt;</span><span class="nc">T</span><span class="p">&gt;,</span>
    <span class="kd">val</span> <span class="py">provider</span><span class="p">:</span> <span class="nc">FeatureFlagProvider</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">checkedListener</span><span class="p">:</span> <span class="nc">Function2</span><span class="p">&lt;</span><span class="nc">Feature</span><span class="p">,</span> <span class="nc">Boolean</span><span class="p">,</span> <span class="nc">Unit</span><span class="p">&gt;</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">RecyclerView</span><span class="p">.</span><span class="nc">Adapter</span><span class="p">&lt;</span><span class="nc">FeatureFlagViewHolder</span><span class="p">&lt;</span><span class="nc">T</span><span class="p">&gt;&gt;()</span> <span class="p">{</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">getItemCount</span><span class="p">():</span> <span class="nc">Int</span> <span class="p">=</span> <span class="n">items</span><span class="p">.</span><span class="n">size</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">onBindViewHolder</span><span class="p">(</span><span class="n">holder</span><span class="p">:</span> <span class="nc">FeatureFlagViewHolder</span><span class="p">&lt;</span><span class="nc">T</span><span class="p">&gt;,</span> <span class="n">position</span><span class="p">:</span> <span class="nc">Int</span><span class="p">)</span> <span class="p">=</span>
        <span class="n">holder</span><span class="p">.</span><span class="nf">bind</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="n">position</span><span class="p">])</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">onCreateViewHolder</span><span class="p">(</span><span class="n">parent</span><span class="p">:</span> <span class="nc">ViewGroup</span><span class="p">,</span> <span class="n">viewType</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">FeatureFlagViewHolder</span><span class="p">&lt;</span><span class="nc">T</span><span class="p">&gt;</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">itemView</span> <span class="p">=</span> <span class="nc">LayoutInflater</span><span class="p">.</span><span class="nf">from</span><span class="p">(</span><span class="n">parent</span><span class="p">.</span><span class="n">context</span><span class="p">).</span><span class="nf">inflate</span><span class="p">(</span><span class="nc">R</span><span class="p">.</span><span class="n">layout</span><span class="p">.</span><span class="n">item_featureflag</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="k">false</span><span class="p">)</span>
        <span class="k">return</span> <span class="nc">FeatureFlagViewHolder</span><span class="p">(</span><span class="n">itemView</span><span class="p">,</span> <span class="n">provider</span><span class="p">,</span> <span class="n">checkedListener</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Now it becomes clear why <code class="language-plaintext highlighter-rouge">FeatureFlags</code> and <code class="language-plaintext highlighter-rouge">TestSettings</code> had to be enums, because this allows to pass the <code class="language-plaintext highlighter-rouge">FeatureFlagAdapter</code> either <code class="language-plaintext highlighter-rouge">FeatureFlag.values()</code> or <code class="language-plaintext highlighter-rouge">TestSetting.values()</code> and automatically generate the UI for all defined <code class="language-plaintext highlighter-rouge">FeatureFlags</code> or <code class="language-plaintext highlighter-rouge">TestSettings</code>.</p>

<p>Additionally we hand it the <code class="language-plaintext highlighter-rouge">RuntimeFeatureFlagProvider</code> to look up the current values of each <code class="language-plaintext highlighter-rouge">Feature</code>. Finally it needs a listener to respond when an item gets enabled/disabled.</p>

<p>The <code class="language-plaintext highlighter-rouge">FeatureFlagViewHolder</code> simply binds the properties of the <code class="language-plaintext highlighter-rouge">Feature</code> to the view, requests the current value from the <code class="language-plaintext highlighter-rouge">FeatureFlagProvider</code> and connects a listener to the switch:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="kd">class</span> <span class="nc">FeatureFlagViewHolder</span><span class="p">&lt;</span><span class="nc">T</span> <span class="p">:</span> <span class="nc">Feature</span><span class="p">&gt;(</span>
    <span class="n">view</span><span class="p">:</span> <span class="nc">View</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">provider</span><span class="p">:</span> <span class="nc">FeatureFlagProvider</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">checkedListener</span><span class="p">:</span> <span class="nc">Function2</span><span class="p">&lt;</span><span class="nc">Feature</span><span class="p">,</span> <span class="nc">Boolean</span><span class="p">,</span> <span class="nc">Unit</span><span class="p">&gt;</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">RecyclerView</span><span class="p">.</span><span class="nc">ViewHolder</span><span class="p">(</span><span class="n">view</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">fun</span> <span class="nf">bind</span><span class="p">(</span><span class="n">feature</span><span class="p">:</span> <span class="nc">T</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">title</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="n">feature</span><span class="p">.</span><span class="n">title</span>
        <span class="n">description</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="n">feature</span><span class="p">.</span><span class="n">explanation</span>
        <span class="n">switch</span><span class="p">.</span><span class="n">isChecked</span> <span class="p">=</span> <span class="n">provider</span><span class="p">.</span><span class="nf">isFeatureEnabled</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
        <span class="n">switch</span><span class="p">.</span><span class="nf">setOnCheckedChangeListener</span> <span class="p">{</span> <span class="n">switch</span><span class="p">,</span> <span class="n">isChecked</span> <span class="p">-&gt;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">switch</span><span class="p">.</span><span class="n">isPressed</span><span class="p">)</span> <span class="n">checkedListener</span><span class="p">.</span><span class="nf">invoke</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">isChecked</span><span class="p">)</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The listener passed into the <code class="language-plaintext highlighter-rouge">FeatureFlagAdapter</code> simply changes the value of the <code class="language-plaintext highlighter-rouge">Feature</code> on the <code class="language-plaintext highlighter-rouge">RuntimeFeatureFlagProvider</code> and shows a <code class="language-plaintext highlighter-rouge">SnackBar</code> to restart the app to ensure the new value is properly applied:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">val</span> <span class="py">checkedListener</span> <span class="p">=</span> <span class="p">{</span> <span class="n">feature</span><span class="p">:</span> <span class="nc">Feature</span><span class="p">,</span> <span class="n">enabled</span><span class="p">:</span> <span class="nc">Boolean</span> <span class="p">-&gt;</span>
    <span class="n">runtimeFeatureFlagProvider</span><span class="p">.</span><span class="nf">setFeatureEnabled</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">enabled</span><span class="p">)</span>
    <span class="nf">requestRestart</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="k">fun</span> <span class="nf">requestRestart</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">msg</span> <span class="p">=</span> <span class="s">"In order for changes to reflect please restart the app via settings"</span>
    <span class="nc">Snackbar</span><span class="p">.</span><span class="nf">make</span><span class="p">(</span><span class="n">view</span><span class="o">!!</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="nc">Snackbar</span><span class="p">.</span><span class="nc">LENGTH_INDEFINITE</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">setActionTextColor</span><span class="p">(</span><span class="nc">Color</span><span class="p">.</span><span class="nc">RED</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">setAction</span><span class="p">(</span><span class="s">"Force Stop"</span><span class="p">)</span> <span class="p">{</span> <span class="nf">exitProcess</span><span class="p">(-</span><span class="mi">1</span><span class="p">)</span> <span class="p">}</span>
        <span class="p">.</span><span class="nf">show</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Now we just wrap all of this into a <code class="language-plaintext highlighter-rouge">TestSettingsActivity</code> with a separate launch icon and make sure this activity isn’t available in release builds. The simplest way to do this is by moving all UI classes to the <code class="language-plaintext highlighter-rouge">debug</code> source folder.</p>

<p>Now we have a very powerful, easy to use UI framework to dynamically configure the behavior of our app! By just adding a single line <code class="language-plaintext highlighter-rouge">FeatureFlag</code> or <code class="language-plaintext highlighter-rouge">TestSetting</code> it instantly shows up in our UI.</p>

<blockquote>
  <p>Debug builds have a UI to toggle all <code class="language-plaintext highlighter-rouge">FeatureFlags</code> and <code class="language-plaintext highlighter-rouge">TestSettings</code> on or off that gets fully automatically generated.</p>
</blockquote>

<h2 id="remote-feature-flags">Remote feature flags</h2>
<p>Whilst talking about the <code class="language-plaintext highlighter-rouge">FirebaseFeatureFlagProvider</code> before, there is one important aspect that we didn’t cover: how to refresh the local <code class="language-plaintext highlighter-rouge">FeatureFlag</code> cache with new remote values. Some feature flag tools do that for you automatically, but for others (like Firebase Remote Config), you need to trigger that process manually.</p>

<p>A way to make that fit into our architecture is to define an additional interface <code class="language-plaintext highlighter-rouge">RemoteFeatureFlagProvider</code> that every <code class="language-plaintext highlighter-rouge">FeatureFlagProvider</code> for a remote tool should implement.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">interface</span> <span class="nc">RemoteFeatureFlagProvider</span> <span class="p">{</span>
    <span class="k">fun</span> <span class="nf">refreshFeatureFlags</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Now we just need to expand the <code class="language-plaintext highlighter-rouge">FirebaseFeatureFlagProvider</code> with this interface and implement <code class="language-plaintext highlighter-rouge">refreshFeatureFlags</code>:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">FirebaseFeatureFlagProvider</span><span class="p">(</span><span class="k">private</span> <span class="kd">val</span> <span class="py">isDevModeEnabled</span><span class="p">:</span> <span class="nc">Boolean</span><span class="p">)</span> <span class="p">:</span>
    <span class="nc">FeatureFlagProvider</span><span class="p">,</span> <span class="nc">RemoteFeatureFlagProvider</span> <span class="p">{</span>
    <span class="o">..</span><span class="p">.</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">refreshFeatureFlags</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">remoteConfig</span><span class="p">.</span><span class="nf">fetch</span><span class="p">(</span><span class="nf">getCacheExpirationSeconds</span><span class="p">(</span><span class="n">isDevModeEnabled</span><span class="p">)).</span><span class="nf">addOnCompleteListener</span> <span class="p">{</span> <span class="n">task</span> <span class="p">-&gt;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">task</span><span class="p">.</span><span class="n">isSuccessful</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// After config data is successfully fetched, it must be activated before newly fetched values are returned.</span>
                <span class="n">remoteConfig</span><span class="p">.</span><span class="nf">activateFetched</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">getCacheExpirationSeconds</span><span class="p">(</span><span class="n">isDevModeEnabled</span><span class="p">:</span> <span class="nc">Boolean</span><span class="p">):</span> <span class="nc">Long</span> <span class="p">=</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">isDevModeEnabled</span><span class="p">)</span> <span class="nc">ONE_SECOND</span> <span class="k">else</span> <span class="nc">ONE_HOUR</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Then we expose a new function on the <code class="language-plaintext highlighter-rouge">RuntimeBehavior</code> to refresh all remote feature flag providers at the same time whenever you want in your app lifecycle.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>object RuntimeBehavior {
    fun refreshFeatureFlags() {
        providers.filter { it is RemoteFeatureFlagProvider }.forEach { (it as RemoteFeatureFlagProvider).refreshFeatureFlags() }
    }
}
</code></pre></div></div>

<p>Since Firebase Remote Config internally throttles refresh requests, it’s safe to call the <code class="language-plaintext highlighter-rouge">refreshFeatureFlags</code> method on every app resume.</p>

<blockquote>
  <p>The <code class="language-plaintext highlighter-rouge">RemoteFeatureFlagProvider</code> offers the generic ability to refresh values for all remote feature flagging tools.</p>
</blockquote>

<h2 id="testing-feature-flags">Testing feature flags</h2>
<p>During automated unit or espresso tests, you sometimes need to enable/disable particular features. Even that is simple with this architecture, just make a <code class="language-plaintext highlighter-rouge">TestFeatureFlagProvider</code>:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">object</span> <span class="nc">TestFeatureFlagProvider</span> <span class="p">:</span> <span class="nc">FeatureFlagProvider</span> <span class="p">{</span>

    <span class="k">private</span> <span class="kd">val</span> <span class="py">features</span> <span class="p">=</span> <span class="nc">HashMap</span><span class="p">&lt;</span><span class="nc">Feature</span><span class="p">,</span> <span class="nc">Boolean</span><span class="p">&gt;()</span>

    <span class="k">override</span> <span class="kd">val</span> <span class="py">priority</span> <span class="p">=</span> <span class="nc">TEST_PRIORITY</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">isFeatureEnabled</span><span class="p">(</span><span class="n">feature</span><span class="p">:</span> <span class="nc">Feature</span><span class="p">):</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="n">features</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">!!</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">hasFeature</span><span class="p">(</span><span class="n">feature</span><span class="p">:</span> <span class="nc">Feature</span><span class="p">):</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="n">features</span><span class="p">.</span><span class="nf">containsKey</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>

    <span class="k">fun</span> <span class="nf">setFeatureEnabled</span><span class="p">(</span><span class="n">feature</span><span class="p">:</span> <span class="nc">Feature</span><span class="p">,</span> <span class="n">enabled</span><span class="p">:</span> <span class="nc">Boolean</span><span class="p">)</span> <span class="p">=</span> <span class="n">features</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">enabled</span><span class="p">)</span>

    <span class="k">fun</span> <span class="nf">clearFeatures</span><span class="p">()</span> <span class="p">=</span> <span class="n">features</span><span class="p">.</span><span class="nf">clear</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div></div>

<p>With its <code class="language-plaintext highlighter-rouge">TEST_PRIORITY</code> it takes precedence over all other <code class="language-plaintext highlighter-rouge">FeatureFlagProviders</code> and exposes an API to dynamically enable/disable features and to clear its state after each test.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="k">fun</span> <span class="nf">withFeatureFlags</span><span class="p">()</span> <span class="p">{</span>
    <span class="nc">TestFeatureFlagProvider</span><span class="p">.</span><span class="nf">enableFeature</span><span class="p">(</span><span class="nc">DARK_MODE</span><span class="p">)</span>

    <span class="c1">// do test here</span>
<span class="p">}</span>

<span class="nd">@After</span>
<span class="k">fun</span> <span class="nf">tearDown</span><span class="p">()</span> <span class="p">{</span>
    <span class="nc">TestFeatureFlagProvider</span><span class="p">.</span><span class="nf">clearFeatures</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div></div>

<p>And this extra provider gets added during the debug initialization in the <code class="language-plaintext highlighter-rouge">RuntimeBehavior</code>:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">object</span> <span class="nc">RuntimeBehavior</span> <span class="p">{</span>

    <span class="nd">@VisibleForTesting</span>
    <span class="k">internal</span> <span class="kd">val</span> <span class="py">providers</span> <span class="p">=</span> <span class="nc">CopyOnWriteArrayList</span><span class="p">&lt;</span><span class="nc">FeatureFlagProvider</span><span class="p">&gt;()</span>

    <span class="k">fun</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="nc">Context</span><span class="p">,</span> <span class="n">isDebugBuild</span><span class="p">:</span> <span class="nc">Boolean</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">isDebugBuild</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">val</span> <span class="py">runtimeFeatureFlagProvider</span> <span class="p">=</span> <span class="nc">RuntimeFeatureFlagProvider</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
            <span class="nf">addProvider</span><span class="p">(</span><span class="n">runtimeFeatureFlagProvider</span><span class="p">)</span>
            <span class="nf">addProvider</span><span class="p">(</span><span class="nc">TestFeatureFlagProvider</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">runtimeFeatureFlagProvider</span><span class="p">.</span><span class="nf">isFeatureEnabled</span><span class="p">(</span><span class="nc">TestSetting</span><span class="p">.</span><span class="nc">DEBUG_FIREBASE</span><span class="p">))</span> <span class="p">{</span>
                <span class="nf">addProvider</span><span class="p">(</span><span class="nc">FirebaseFeatureFlagProvider</span><span class="p">(</span><span class="k">true</span><span class="p">))</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">addProvider</span><span class="p">(</span><span class="nc">StoreFeatureFlagProvider</span><span class="p">())</span>
            <span class="nf">addProvider</span><span class="p">(</span><span class="nc">FirebaseFeatureFlagProvider</span><span class="p">(</span><span class="k">false</span><span class="p">))</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p>The <code class="language-plaintext highlighter-rouge">TestFeatureFlagProvider</code> allows to turn <code class="language-plaintext highlighter-rouge">FeatureFlags</code> or <code class="language-plaintext highlighter-rouge">TestSettings</code> on during unit/instrumentation tests.</p>
</blockquote>

<h2 id="putting-it-all-together">Putting it all together</h2>
<p>When we look at all of the classes involved we get the following overview:</p>

<p><img src="https://jeroenmols.com/img/blog/featureflagarchitecture/featureflag_architecture.png" alt="Feature flag architecture" /></p>

<p>While that might seem a bit overwhelming, it consists of a lot of very small classes that are very easy to understand:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">RuntimeBehavior</code>: to easily consume feature flags</li>
  <li><code class="language-plaintext highlighter-rouge">FeatureFlagProvider</code>: to provide values during debug, release or testing</li>
  <li><code class="language-plaintext highlighter-rouge">Feature</code>: one-line definition of <code class="language-plaintext highlighter-rouge">FeatureFlags</code> or <code class="language-plaintext highlighter-rouge">TestSettings</code></li>
</ul>

<p>And based on these classes, a local UI is automagically generated to toggle the <code class="language-plaintext highlighter-rouge">Features</code> on/off in debug builds!</p>

<p>I’ve created a full Github sample project where you can see all code in action <a href="https://github.com/JeroenMols/FeatureFlagExample">here</a></p>

<h2 id="bonus">Bonus</h2>
<p>When combining this Feature Flag architecture with my previous <a href="/blog/2019/03/18/modularizationarchitecture/">modularization architecture</a>, all UI classes can be moved to their own feature module <code class="language-plaintext highlighter-rouge">test-settings</code> that is only included into the <code class="language-plaintext highlighter-rouge">app</code> module for debug builds:</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dependencies</span> <span class="o">{</span>
    <span class="n">debugImplementation</span> <span class="nf">project</span><span class="o">(</span><span class="s1">':features:test-settings'</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></div></div>

<p>This does require all feature flag business logic to move to a library module <code class="language-plaintext highlighter-rouge">feature-flags</code>, but the end result is a very clean!</p>

<h2 id="wrap-up">Wrap-up</h2>
<p>With just a few simple classes we’ve been able to build a powerful feature flagging architecture. In that it’s very easy to add new features, there is support for both local and remote feature flags, feature flags are testable and a local UI for enabling/disabling feature flags is automatically generated.</p>

<p>If you’ve made it this far you should probably follow me on <span><a href="https://twitter.com/molsjeroen?source=featureflags-asuccessfularchitecture2019" class="ga-link" target="_blank">Twitter</a></span>
. Feel free leave a comment below!</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/android" class="page__taxonomy-item" rel="tag">android</a><span class="sep">, </span>
    
      <a href="/tags/architecture" class="page__taxonomy-item" rel="tag">architecture</a><span class="sep">, </span>
    
      <a href="/tags/feature-flags" class="page__taxonomy-item" rel="tag">feature flags</a><span class="sep">, </span>
    
      <a href="/tags/firebase" class="page__taxonomy-item" rel="tag">firebase</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/blog" class="page__taxonomy-item" rel="tag">blog</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Updated:</strong> <time datetime="2019-09-12T00:00:00+02:00">September 12, 2019</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?via=molsjeroen&text=Feature+flags+-+A+successful+architecture%20https%3A%2F%2Fjeroenmols.com%2Fblog%2F2019%2F09%2F12%2Ffeatureflagsarchitecture%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fjeroenmols.com%2Fblog%2F2019%2F09%2F12%2Ffeatureflagsarchitecture%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fjeroenmols.com%2Fblog%2F2019%2F09%2F12%2Ffeatureflagsarchitecture%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      <section class="page__share">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- bottom-blog-responsive -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-9854541518226004"
       data-ad-slot="4086741379"
       data-ad-format="auto"></ins>
  <script>
  (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</section>


      
  <nav class="pagination">
    
      <a href="/blog/2019/08/20/featureflagshowtouse/" class="pagination--pager" title="Feature Flags - How to use
">Previous</a>
    
    
      <a href="/blog/2020/01/09/yearinreview/" class="pagination--pager" title="Year in review 2019
">Next</a>
    
  </nav>

    </div>

    
      <div class="page__comments">
  
  
      <h4 class="page__comments-title">Leave a Comment</h4>
      <section id="disqus_thread"></section>
    
</div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item" style="position: relative">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    <div style="position:relative;">
      
        <div class="archive__item-teaser" style="background-image: url(/img/blog/offline-react-phone/offline-react-phone.png)"></div>
      
      <div class="archive__item_titlecontainer">
        <h2 class="archive__item-title" itemprop="headline">
            <a href="/blog/2022/11/19/react-local-development/" rel="permalink">Test React app on mobile without Wi-Fi
</a>
        </h2>
        <h3 class="archive__date">19 Nov 2022</h3>
      </div>
      
        <a href="/blog/2022/11/19/react-local-development/" rel="permalink">
          <div class="archive__item-teaser-imageclickhandler"></div>
        </a>
      
    </div>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  less than 1 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">Traveling by train or plane and want to test your react app on your mobile phone? This quick post explains how to access your react development server from your phone without a Wi-Fi connection.
</p>
  </article>
</div>

        
          



<div class="grid__item" style="position: relative">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    <div style="position:relative;">
      
        <div class="archive__item-teaser" style="background-image: url(/img/blog/workmanager-crash/workmanager-crash.jpg)"></div>
      
      <div class="archive__item_titlecontainer">
        <h2 class="archive__item-title" itemprop="headline">
            <a href="/blog/2022/04/27/workmanager-crash/" rel="permalink">The curious case of crashing Workers
</a>
        </h2>
        <h3 class="archive__date">27 Apr 2022</h3>
      </div>
      
        <a href="/blog/2022/04/27/workmanager-crash/" rel="permalink">
          <div class="archive__item-teaser-imageclickhandler"></div>
        </a>
      
    </div>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  3 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">WorkManager is great to schedule background work on Android. However, since scheduled work lives outside of the app lifecycle, you might run into unexpected crashes.
</p>
  </article>
</div>

        
          



<div class="grid__item" style="position: relative">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    <div style="position:relative;">
      
        <div class="archive__item-teaser" style="background-image: url(/img/blog/pullrequestreview/pullrequestreview.jpeg)"></div>
      
      <div class="archive__item_titlecontainer">
        <h2 class="archive__item-title" itemprop="headline">
            <a href="/blog/2022/02/23/pull-request-reviews/" rel="permalink">No, your pull request does not need a review
</a>
        </h2>
        <h3 class="archive__date">23 Feb 2022</h3>
      </div>
      
        <a href="/blog/2022/02/23/pull-request-reviews/" rel="permalink">
          <div class="archive__item-teaser-imageclickhandler"></div>
        </a>
      
    </div>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  4 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">In the past years, my thoughts on pull request reviews have evolved considerably. Given that creating and reviewing pull requests are a core part of our work, let’s talk about those.
</p>
  </article>
</div>

        
          



<div class="grid__item" style="position: relative">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    <div style="position:relative;">
      
        <div class="archive__item-teaser" style="background-image: url(/img/blog/migrateartifactsmaven/migrate_artifacts.jpg)"></div>
      
      <div class="archive__item_titlecontainer">
        <h2 class="archive__item-title" itemprop="headline">
            <a href="/blog/2021/03/24/migrate-artifacts-mavencentral/" rel="permalink">Migrate existing library artifacts from JCenter to Maven Central
</a>
        </h2>
        <h3 class="archive__date">24 Mar 2021</h3>
      </div>
      
        <a href="/blog/2021/03/24/migrate-artifacts-mavencentral/" rel="permalink">
          <div class="archive__item-teaser-imageclickhandler"></div>
        </a>
      
    </div>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  7 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">With JCenter shutting down, many are migrating to Maven Central. And while there are many posts on how to publish new artifacts, also all existing artifacts should be migrated away from JCenter.
</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    

    
      <li><a href="atom.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2022 Jeroen Mols. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




  <script>
  window.ga=function(){ga.q.push(arguments)};ga.q=[];ga.l=+new Date;
  ga('create','UA-63356566-1','auto');
  ga('set', 'anonymizeIp', false);
  ga('send','pageview')
</script>
<script src="https://www.google-analytics.com/analytics.js" async></script>






    
  <script>
    var disqus_config = function () {
      this.page.url = "https://jeroenmols.com/blog/2019/09/12/featureflagsarchitecture/";  /* Replace PAGE_URL with your page's canonical URL variable */
      this.page.identifier = "/blog/2019/09/12/featureflagsarchitecture"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */
    };
    (function() { /* DON'T EDIT BELOW THIS LINE */
      var d = document, s = d.createElement('script');
      s.src = 'https://jeroenmols.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  





  </body>
</html>
