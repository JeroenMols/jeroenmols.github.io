<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

 <title>Jeroen Mols</title>
 <link href="jeroenmols.github.io/atom.xml" rel="self"/>
 <link href="jeroenmols.github.io/"/>
 <updated>2015-11-16T06:51:38+01:00</updated>
 <id>jeroenmols.github.io</id>
 <author>
   <name>Jeroen Mols</name>
   <email></email>
 </author>

 
 <entry>
   <title>Level up GitHub builds with CI and code coverage</title>
   <link href="jeroenmols.github.io/blog/2015/11/13/traviscoveralls/"/>
   <updated>2015-11-13T00:00:00+01:00</updated>
   <id>jeroenmols.github.io/blog/2015/11/13/traviscoveralls</id>
   <content type="html">&lt;p&gt;Wouldn&amp;#39;t you love to have your open source projects built automatically by a continuous integration server? And to have a detailed code coverage report for all your unit tests? Even when someone generated a pull request? And how about having cool badges to show off all of this?&lt;/p&gt;

&lt;p&gt;&lt;center&gt;&lt;a href=&quot;https://travis-ci.org/JeroenMols/LandscapeVideoCamera&quot;&gt;&lt;img src=&quot;https://travis-ci.org/JeroenMols/LandscapeVideoCamera.svg?branch=master&quot; alt=&quot;Build Status&quot;&gt;&lt;/a&gt; &lt;a href=&quot;https://coveralls.io/github/JeroenMols/LandscapeVideoCamera?branch=master&quot;&gt;&lt;img src=&quot;https://coveralls.io/repos/JeroenMols/LandscapeVideoCamera/badge.svg?branch=master&amp;amp;service=github&quot; alt=&quot;Coverage Status&quot;&gt;&lt;/a&gt;&lt;/center&gt;&lt;/p&gt;

&lt;p&gt;Actually, all of this a breeze to set up, once you understand what works and what doesn&amp;#39;t. It is even completely free for open source projects!&lt;/p&gt;

&lt;p&gt;In less than half an hour, this blogpost will add CI and code coverage to your projects, just like I did for my own library &lt;a href=&quot;https://github.com/JeroenMols/LandscapeVideoCamera&quot;&gt;LandscapeVideoCamera&lt;/a&gt;. While this article focusses on Android, the material presented here can quite easily be extended to a broader scope.&lt;/p&gt;

&lt;h2&gt;Preface&lt;/h2&gt;

&lt;p&gt;In order to keep things simple, I created a very basic project containing a &lt;a href=&quot;https://github.com/JeroenMols/TravisCoverallsExample/blob/master/app/src/main/java/com/jeroenmols/traviscoveralls/Calculator.java&quot;&gt;Calculator class&lt;/a&gt; and some &lt;a href=&quot;https://github.com/JeroenMols/TravisCoverallsExample/blob/master/app/src/androidTest/java/com/jeroenmols/traviscoveralls/CalculatorTest.java&quot;&gt;Android tests&lt;/a&gt;. This will make things easier to understand as we&amp;#39;ll add everything step by step to this project.&lt;/p&gt;

&lt;p&gt;Later on I will present a more elaborate (and usefull) example, namely my own open source library &lt;a href=&quot;https://github.com/JeroenMols/LandscapeVideoCamera&quot;&gt;LandscapeVideoCamera&lt;/a&gt;. Some time ago, I test driven refactored this project completely resulting in respectable code coverage statistics.&lt;/p&gt;

&lt;h2&gt;Travis&lt;/h2&gt;

&lt;h3&gt;About&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;https://travis-ci.org/&quot;&gt;Travis&lt;/a&gt; is a feature rich online CI service which integrates nicely with a lot of existing services. One major advantage over Jenkins is that you can put the entire CI configuration file under version control. It is completely free for open source projects, although private repositories are also supported on a subscription basis.&lt;/p&gt;

&lt;p&gt;&lt;center&gt;&lt;a href=&quot;/img/blog/traviscoveralls/travis-workflow.png&quot;&gt;&lt;img src=&quot;/img/blog/traviscoveralls/travis-workflow.png&quot; alt=&quot;Travis workflow&quot;&gt;&lt;/a&gt;&lt;/center&gt;&lt;/p&gt;

&lt;h3&gt;Basic configuration&lt;/h3&gt;

&lt;p&gt;In order to get started, go to &lt;a href=&quot;https://travis-ci.org/&quot;&gt;travis-ci.org&lt;/a&gt;, login with your GitHub account and authorize Travis to access your repositories.&lt;/p&gt;

&lt;p&gt;&lt;center&gt;&lt;a href=&quot;/img/blog/traviscoveralls/travis-authorize.png&quot;&gt;&lt;img src=&quot;/img/blog/traviscoveralls/travis-authorize.png&quot; alt=&quot;Allow Travis to access your GitHub projects&quot;&gt;&lt;/a&gt;&lt;/center&gt;&lt;/p&gt;

&lt;p&gt;Next, create a new file &lt;code&gt;.travis.yml&lt;/code&gt; into the root of your project (note that this file will be hidden on Mac OSX/Linux systems). Open the file and specify the language of your project, in our case Android:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-yaml&quot; data-lang=&quot;yaml&quot;&gt;&lt;span class=&quot;l-Scalar-Plain&quot;&gt;language&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;android&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now Travis needs to know all dependencies in order to build the project. As such specify the build tools version and compile Android SDK version (note that this must match the &lt;code&gt;compileSdkVersion&lt;/code&gt; of your &lt;a href=&quot;https://github.com/JeroenMols/TravisCoverallsExample/blob/master/app/build.gradle&quot;&gt;&lt;code&gt;build.gradle&lt;/code&gt;&lt;/a&gt; file!). While there is an option to use the latest build tools version, I recommend to declare an explicit version as this makes your builds more reproducible. Next specify all of the Android SDK manager dependencies your project needs so Travis can install them before building the project.&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-yaml&quot; data-lang=&quot;yaml&quot;&gt;&lt;span class=&quot;l-Scalar-Plain&quot;&gt;android&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;components&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;build-tools-22.0.1&lt;/span&gt;
    &lt;span class=&quot;p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;android-23&lt;/span&gt;
    &lt;span class=&quot;p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;extra-android-m2repository&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Note that our sample only depends on the AppCompat and design support library, hence there is only one extra defined &lt;code&gt;extra-android-m2repository&lt;/code&gt;. In case your project uses other dependencies from the Android SDK, you can easily select them from the entire &lt;a href=&quot;https://github.com/JeroenMols/TravisCoverallsExample/blob/master/misc/android_sdk_dependencies.txt&quot;&gt;dependency list&lt;/a&gt; and add an extra item.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Extra: listing Android SDK dependencies&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;To generate the above mentioned list of Android SDK components, simply run the following command on your local machine:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;android list sdk --no-ui --all --extended
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/blockquote&gt;

&lt;p&gt;After, specify the exact &lt;code&gt;Gradle&lt;/code&gt; command to run, in our case &lt;code&gt;assembleDebug&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-yaml&quot; data-lang=&quot;yaml&quot;&gt;&lt;span class=&quot;l-Scalar-Plain&quot;&gt;script&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;./gradlew assembleDebug&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now that we have configured everything in the &lt;code&gt;travis.yml&lt;/code&gt; file, we need to enable the project, so Travis will start listening to code changes. This can be done by going to your profile on &lt;a href=&quot;http://travis-ci.org&quot;&gt;Travis&lt;/a&gt; and flipping the appropriate slider.&lt;/p&gt;

&lt;p&gt;&lt;center&gt;&lt;a href=&quot;/img/blog/traviscoveralls/travis-enableproject.png&quot;&gt;&lt;img src=&quot;/img/blog/traviscoveralls/travis-enableproject.png&quot; alt=&quot;Enable project in Travis&quot;&gt;&lt;/a&gt;&lt;/center&gt;&lt;/p&gt;

&lt;p&gt;This will result in the project being shown on the left hand side of your dashboard, while indicating that there are no builds.&lt;/p&gt;

&lt;p&gt;&lt;center&gt;&lt;a href=&quot;/img/blog/traviscoveralls/travis-nobuilds.png&quot;&gt;&lt;img src=&quot;/img/blog/traviscoveralls/travis-nobuilds.png&quot; alt=&quot;Travis overview with no builds, push code to origin to trigger a build.&quot;&gt;&lt;/a&gt;&lt;/center&gt;&lt;/p&gt;

&lt;p&gt;Builds are automatically triggered whenever you push code to your GitHub repository or someone else creates a pull request. Therefore push some changes to GitHub and watch Travis pick them up automatically and start building your project.&lt;/p&gt;

&lt;p&gt;&lt;center&gt;&lt;a href=&quot;/img/blog/traviscoveralls/travis-firstbuild.png&quot;&gt;&lt;img src=&quot;/img/blog/traviscoveralls/travis-firstbuild.png&quot; alt=&quot;First build in Travis&quot;&gt;&lt;/a&gt;&lt;/center&gt;&lt;/p&gt;

&lt;p&gt;Congrats! You now have a fully working Continuous Integration server for your &lt;a href=&quot;https://travis-ci.org/JeroenMols/TravisCoverallsExample&quot;&gt;open source project&lt;/a&gt;.&lt;/p&gt;

&lt;h3&gt;Running Android unit tests&lt;/h3&gt;

&lt;p&gt;While running normal unit tests is straight forward, Android tests are a different story because they require an Android emulator to run on. And because Travis support for Android is still in &lt;a href=&quot;http://docs.travis-ci.com/user/languages/android/&quot;&gt;beta&lt;/a&gt;, there are a couple of limitations to consider:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;Only &lt;code&gt;armeabi-v7a&lt;/code&gt; emulators are supported.&lt;/li&gt;
&lt;li&gt;The Android M emulator is not yet supported.&lt;/li&gt;
&lt;/ol&gt;

&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Extra limitations of Travis Android support&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;You can &lt;em&gt;skip this if you want&lt;/em&gt;, just some extra context&lt;/p&gt;

&lt;p&gt;First of all, Travis does not yet support HAXM to speed up intel emulators, so there is no speed up while using an &lt;code&gt;x86&lt;/code&gt; emulator. Even more, the latest &lt;code&gt;x86_64 Android M&lt;/code&gt; emulator requires hardware acceleration, so that one simply cannot be used on Travis! For more information see issue &lt;a href=&quot;https://github.com/travis-ci/travis-ci/issues/1419&quot;&gt;1419&lt;/a&gt; and &lt;a href=&quot;https://github.com/travis-ci/travis-ci/issues/1395&quot;&gt;1395&lt;/a&gt; or check out this &lt;a href=&quot;https://travis-ci.org/JeroenMols/LandscapeVideoCamera/builds/88619658#L693&quot;&gt;failing build&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Secondly, Travis does not yet support the latest Android M emulator, causing the built-in &lt;code&gt;android-wait-for-emulator&lt;/code&gt; script to time out while the emulator is booting. Therefore I recommend to use the &lt;code&gt;android-22&lt;/code&gt; emulator instead. For more information see this &lt;a href=&quot;https://travis-ci.org/JeroenMols/LandscapeVideoCamera/builds/88620580#L1069&quot;&gt;failing build&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;So you&amp;#39;ll have to accept that builds will be slow (starting emulator + running test) and that you cannot use an Android M emulator. But if these are acceptable, read on and I&amp;#39;ll explain how to set up everything for running tests.&lt;/p&gt;

&lt;p&gt;First of all, define the Android version and processor architecture of the emulator by adding a new environment at the top of the &lt;code&gt;travis.yml&lt;/code&gt; file:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-yaml&quot; data-lang=&quot;yaml&quot;&gt;&lt;span class=&quot;l-Scalar-Plain&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;matrix&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;ANDROID_TARGET=android-22 ANDROID_ABI=armeabi-v7a&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then, ensure that all dependencies for the Android emulator are installed, by adding both the platform version and emulator image to the &lt;code&gt;components&lt;/code&gt; section. Note that it is important to add both, because the Android emulator will only install if the corresponding Android platform is installed (see this &lt;a href=&quot;https://travis-ci.org/JeroenMols/LandscapeVideoCamera/builds/88631850#L815&quot;&gt;failing build&lt;/a&gt;).&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-yaml&quot; data-lang=&quot;yaml&quot;&gt;&lt;span class=&quot;l-Scalar-Plain&quot;&gt;android&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;components&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;l-Scalar-Plain&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;l-Scalar-Plain&quot;&gt;- android-22&lt;/span&gt;
    &lt;span class=&quot;l-Scalar-Plain&quot;&gt;- sys-img-armeabi-v7a-android-22&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now we need to create a new Android emulator and start it before our build. As starting takes a really long time, Travis offers a built-in &lt;code&gt;android-wait-for-emulator&lt;/code&gt; script to facilitate this. Finally we need to unlock the emulator once started by sending a key event.&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-yaml&quot; data-lang=&quot;yaml&quot;&gt;&lt;span class=&quot;l-Scalar-Plain&quot;&gt;before_script&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;echo no | android create avd --force -n test -t $ANDROID_TARGET --abi $ANDROID_ABI&lt;/span&gt;
    &lt;span class=&quot;p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;emulator -avd test -no-skin -no-audio -no-window &amp;amp;&lt;/span&gt;
    &lt;span class=&quot;p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;android-wait-for-emulator&lt;/span&gt;
    &lt;span class=&quot;p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;adb shell input keyevent 82 &amp;amp;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;After all of this configuration, all we need to do is change the &lt;code&gt;Gradle&lt;/code&gt; command to run all of the tests and trigger a new build by pushing all these changes.&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-yaml&quot; data-lang=&quot;yaml&quot;&gt;&lt;span class=&quot;l-Scalar-Plain&quot;&gt;script&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;./gradlew connectedAndroidTest&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Taking things further&lt;/h3&gt;

&lt;p&gt;As mentioned in the introduction, Travis is a really feature rich CI service. Therefore this section provides some tips to take things even further.&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Build notifications:&lt;/strong&gt; Travis supports sending notifications via Slack, HipChat, email,... whenever a built fails/succeeds.&lt;/p&gt;
For more information, have a look at the &lt;a href=&quot;http://docs.travis-ci.com/user/notifications/&quot;&gt;Travis documentation&lt;/a&gt;.&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-yaml&quot; data-lang=&quot;yaml&quot;&gt;&lt;span class=&quot;l-Scalar-Plain&quot;&gt;notifications&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;l-Scalar-Plain&quot;&gt;email&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;your.email@gmail.com&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;Build status badge:&lt;/strong&gt; Click the build badge on your Travis homepage to generate png/markdown/... build badges.&lt;/p&gt;
&lt;a href=&quot;https://travis-ci.org/JeroenMols/TravisCoverallsExample&quot;&gt;&lt;img src=&quot;https://travis-ci.org/JeroenMols/TravisCoverallsExample.svg?branch=master&quot; alt=&quot;Build Status&quot;&gt;&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;Branch information:&lt;/strong&gt; Print which branch or pull request is being built.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-yaml&quot; data-lang=&quot;yaml&quot;&gt;&lt;span class=&quot;l-Scalar-Plain&quot;&gt;script&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;echo &amp;quot;Travis branch is $TRAVIS_BRANCH&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;echo &amp;quot;Travis branch is in pull request $TRAVIS_PULL+REQUEST&amp;quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;More options:&lt;/strong&gt; Have a look at the &lt;a href=&quot;http://docs.travis-ci.com/user/languages/android/&quot;&gt;Travis documentation&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;Coveralls&lt;/h2&gt;

&lt;h3&gt;About&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;https://coveralls.io/&quot;&gt;Coveralls&lt;/a&gt; is a visually attractive online code coverage tool which provides detailed statistics such as line coverage and repository trends. Furthermore it allows you to show of your code coverage and encourages you to increase it. Like Travis, it is free for open source projects, but a subscription service is available for private repositories.&lt;/p&gt;

&lt;p&gt;&lt;center&gt;&lt;a href=&quot;/img/blog/traviscoveralls/coveralls-example.png&quot;&gt;&lt;img src=&quot;/img/blog/traviscoveralls/coveralls-example.png&quot; alt=&quot;Example coveralls dashboard&quot;&gt;&lt;/a&gt;&lt;/center&gt;&lt;/p&gt;

&lt;h3&gt;Enabling Android code coverage&lt;/h3&gt;

&lt;p&gt;First of all, your Android project needs to be configured to generate code coverage reports. As such, ensure that you are using at least version 0.4 of the &lt;a href=&quot;https://google.github.io/android-testing-support-library/&quot;&gt;Android testing support library&lt;/a&gt; (there was an &lt;a href=&quot;https://code.google.com/p/android/issues/detail?id=170607&quot;&gt;issue&lt;/a&gt; in version 0.3).&lt;/p&gt;

&lt;p&gt;Then add the flag &lt;code&gt;testCoverageEnabled&lt;/code&gt; to the debug buildTypes in your main module&amp;#39;s &lt;code&gt;build.gradle&lt;/code&gt; file, causing a code coverage report to be generated in the &lt;code&gt;build/reports/coverage/&lt;/code&gt; folder.&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-groovy&quot; data-lang=&quot;groovy&quot;&gt;&lt;span class=&quot;n&quot;&gt;android&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;buildTypes&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;debug&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;testCoverageEnabled&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;At this point, you should be able to run &lt;code&gt;gradle connectedAndroidTest&lt;/code&gt; and view an &lt;code&gt;html&lt;/code&gt; and &lt;code&gt;xml&lt;/code&gt; report in the above mentioned directory.&lt;/p&gt;

&lt;p&gt;&lt;center&gt;&lt;a href=&quot;/img/blog/traviscoveralls/coveralls-rawcoverage.png&quot;&gt;&lt;img src=&quot;/img/blog/traviscoveralls/coveralls-rawcoverage.png&quot; alt=&quot;Basic coverage report generated by the built in Android code coverage&quot;&gt;&lt;/a&gt;&lt;/center&gt;&lt;/p&gt;

&lt;h3&gt;Basic configuration&lt;/h3&gt;

&lt;p&gt;In order to get started, go to &lt;a href=&quot;https://coveralls.io/&quot;&gt;coveralls.io&lt;/a&gt;, login with your GitHub account and authorize Coveralls to access your repositories.&lt;/p&gt;

&lt;p&gt;&lt;center&gt;&lt;a href=&quot;/img/blog/traviscoveralls/coveralls-authorize.png&quot;&gt;&lt;img src=&quot;/img/blog/traviscoveralls/coveralls-authorize.png&quot; alt=&quot;Allow Coveralls to access your GitHub projects&quot;&gt;&lt;/a&gt;&lt;/center&gt;&lt;/p&gt;

&lt;p&gt;Next, we&amp;#39;ll need to configure your &lt;code&gt;build.gradle&lt;/code&gt; files to upload the coverage reports to Coveralls after each successful CI build. Therefore add a new classpath dependency to the root projects &lt;code&gt;build.gradle&lt;/code&gt; file.&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-groovy&quot; data-lang=&quot;groovy&quot;&gt;&lt;span class=&quot;n&quot;&gt;buildscript&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;dependencies&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;classpath&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;org.kt3k.gradle.plugin:coveralls-gradle-plugin:2.4.0&amp;#39;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then we can apply the &lt;code&gt;coveralls&lt;/code&gt; plugin, point it to the coverage reports directory and ensure it only runs on CI builds by adding the following to your main module&amp;#39;s &lt;code&gt;build.gradle&lt;/code&gt; file:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-groovy&quot; data-lang=&quot;groovy&quot;&gt;&lt;span class=&quot;n&quot;&gt;apply&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;plugin:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;com.github.kt3k.coveralls&amp;#39;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-groovy&quot; data-lang=&quot;groovy&quot;&gt;&lt;span class=&quot;n&quot;&gt;coveralls&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;jacocoReportPath&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;${buildDir}/reports/coverage/debug/report.xml&amp;quot;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;tasks&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;coveralls&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;dependsOn&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;connectedAndroidTest&amp;#39;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;onlyIf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;CI&amp;#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Note that we also added a dependency on the &lt;code&gt;connectedAndroidTest&lt;/code&gt; task as that is the one that will actually generate the code coverage report.&lt;/p&gt;

&lt;p&gt;Let&amp;#39;s now change the build task in the &lt;code&gt;travis.yml&lt;/code&gt; so it runs the &lt;code&gt;coveralls&lt;/code&gt; task after every build. While not strictly necessary to still define the &lt;code&gt;connectedAndroidTest&lt;/code&gt; task, I prefer to do so as it makes it more explicit what &lt;code&gt;Gradle&lt;/code&gt; will exactly be building.&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-yaml&quot; data-lang=&quot;yaml&quot;&gt;&lt;span class=&quot;l-Scalar-Plain&quot;&gt;script&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;...&lt;/span&gt;
  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;- ./gradlew connectedAndroidTest coveralls&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Next we need to activate our GitHub repository in coveralls, so it picks up the output from the &lt;code&gt;Gradle&lt;/code&gt; plugin. This can easily be done by clicking &lt;code&gt;add repos&lt;/code&gt; on &lt;a href=&quot;https://coveralls.io&quot;&gt;coveralls.io&lt;/a&gt; and flipping the switch on your repository.&lt;/p&gt;

&lt;p&gt;&lt;center&gt;&lt;a href=&quot;/img/blog/traviscoveralls/coveralls-enableproject.png&quot;&gt;&lt;img src=&quot;/img/blog/traviscoveralls/coveralls-enableproject.png&quot; alt=&quot;Enable project in Coveralls&quot;&gt;&lt;/a&gt;&lt;/center&gt;&lt;/p&gt;

&lt;p&gt;This will result in the project being added to your dashboard without any builds.&lt;/p&gt;

&lt;p&gt;&lt;center&gt;&lt;a href=&quot;/img/blog/traviscoveralls/coveralls-nobuilds.png&quot;&gt;&lt;img src=&quot;/img/blog/traviscoveralls/coveralls-nobuilds.png&quot; alt=&quot;No builds yet in Coveralls&quot;&gt;&lt;/a&gt;&lt;/center&gt;&lt;/p&gt;

&lt;p&gt;Simply trigger a Travis build by pushing some changes to start seeing code coverage results online.&lt;/p&gt;

&lt;p&gt;Finally you can easily add a badge to your repository by clicking the &lt;code&gt;Badge urls&lt;/code&gt; button from the green banner in the detail view.&lt;/p&gt;

&lt;p&gt;&lt;center&gt;&lt;a href=&quot;https://coveralls.io/github/JeroenMols/TravisCoverallsExample?branch=master&quot;&gt;&lt;img src=&quot;https://coveralls.io/repos/JeroenMols/TravisCoverallsExample/badge.svg?branch=master&amp;amp;service=github&quot; alt=&quot;Coverage Status&quot;&gt;&lt;/a&gt;&lt;/center&gt;&lt;/p&gt;

&lt;p&gt;Congratulations you know have attractive code coverage reports for &lt;a href=&quot;https://coveralls.io/github/JeroenMols/TravisCoverallsExample&quot;&gt;your repository&lt;/a&gt;!&lt;/p&gt;

&lt;h2&gt;Wrap-up&lt;/h2&gt;

&lt;p&gt;Adding Travis CI and Coveralls code coverage to your project is fairly straightforward once you know what works and especially what doesn&amp;#39;t work. Hopefully this blogpost was able to remove a lot of those frustrating barriers of entry.&lt;/p&gt;

&lt;p&gt;A basic example project with everything in this blogpost integrated is available on &lt;a href=&quot;https://github.com/JeroenMols/TravisCoverallsExample&quot;&gt;GitHub&lt;/a&gt;. But in case you&amp;#39;re interested in a real life example, have a look at my Android library &lt;a href=&quot;https://github.com/JeroenMols/LandscapeVideoCamera&quot;&gt;LandscapeVideoCamera&lt;/a&gt;, which actually has decent code coverage statistics.&lt;/p&gt;

&lt;p&gt;&lt;center&gt;&lt;a href=&quot;https://travis-ci.org/JeroenMols/LandscapeVideoCamera&quot;&gt;&lt;img src=&quot;https://travis-ci.org/JeroenMols/LandscapeVideoCamera.svg?branch=master&quot; alt=&quot;Build Status&quot;&gt;&lt;/a&gt; &lt;a href=&quot;https://coveralls.io/github/JeroenMols/LandscapeVideoCamera?branch=master&quot;&gt;&lt;img src=&quot;https://coveralls.io/repos/JeroenMols/LandscapeVideoCamera/badge.svg?branch=master&amp;amp;service=github&quot; alt=&quot;Coverage Status&quot;&gt;&lt;/a&gt;&lt;/center&gt;&lt;/p&gt;

&lt;p&gt;As always you can reach me &lt;a href=&quot;https://twitter.com/molsjeroen&quot;&gt;@molsjeroen&lt;/a&gt; on twitter, or leave a comment below!&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Getting the most out of Artifactory</title>
   <link href="jeroenmols.github.io/blog/2015/08/13/artifactory2/"/>
   <updated>2015-08-13T00:00:00+02:00</updated>
   <id>jeroenmols.github.io/blog/2015/08/13/artifactory2</id>
   <content type="html">&lt;p&gt;My previous &lt;a href=&quot;/blog/2015/08/06/artifactory/&quot;&gt;blog post&lt;/a&gt; described how to set up your own private Maven repository with Artifactory in 30 minutes. This second and final part will make things more interesting and take your setup to the next level.&lt;/p&gt;

&lt;p&gt;You will learn how to:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;handle library projects with dependencies&lt;/li&gt;
&lt;li&gt;securely provide username and password&lt;/li&gt;
&lt;li&gt;work with snapshot and release builds&lt;/li&gt;
&lt;li&gt;configure custom repositories&lt;/li&gt;
&lt;li&gt;manage user access&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;All source code is &lt;a href=&quot;https://github.com/JeroenMols/ArtifactoryExample&quot;&gt;available on Github&lt;/a&gt; as usual.&lt;/p&gt;

&lt;p&gt;Note that the material presented here can quite easily be extended to be applicable beyond Android.&lt;/p&gt;

&lt;h2&gt;Library projects with dependencies&lt;/h2&gt;

&lt;p&gt;Imagine if your Android library project itself has dependencies. Then the application using the library wouldn&amp;#39;t be able to run unless it provides all dependencies the library requires.&lt;/p&gt;

&lt;p&gt;To better understand this, consider the new &lt;a href=&quot;https://github.com/JeroenMols/ArtifactoryExample/blob/master/AwesomeAdvancedLibrary/awesomeadvancedlibrary/src/main/java/com/jeroenmols/awesomeadvancedlibrary/AwesomeConvertor.java&quot;&gt;&lt;code&gt;AwesomeAdvancedLibrary&lt;/code&gt;&lt;/a&gt; which makes use of &lt;a href=&quot;https://github.com/google/guava&quot;&gt;Guava&lt;/a&gt; to &lt;em&gt;awesomize&lt;/em&gt; a &lt;code&gt;String&lt;/code&gt;. The application using this library should be agnostic of this dependency. Hence we do not want to define two dependencies:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-groovy&quot; data-lang=&quot;groovy&quot;&gt;&lt;span class=&quot;n&quot;&gt;dependencies&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;compile&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;com.jeroenmols.awesomeadvancedlibrary:awesomeadvancedlibrary:1.0.0&amp;#39;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;compile&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;com.google.guava:guava:18.0&amp;#39;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Instead one &lt;code&gt;compile&lt;/code&gt; dependency should suffice to use the library.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Important note on including dependencies&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;You can &lt;em&gt;skip this if you want&lt;/em&gt;, just some extra context&lt;/p&gt;

&lt;p&gt;Including dependencies in your library is not always a good idea, because this can lead to a dependency conflict while integrating. I only choose Guava to keep things simple, but it is actually a very bad example as it is a utility library. This means it&amp;#39;s quite likely that the app also needs it.&lt;/p&gt;

&lt;p&gt;A better example would be a universal &lt;em&gt;analytics&lt;/em&gt; library offering a universal API to track analytics and redirecting all calls internally to one or more analytics providers. Here packaging dependencies makes sense, because the app never needs to talk to the dependency directly. It also hides implementation details, so the app doesn&amp;#39;t need to be modified when switching to a new provider.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Imagine if we would simply resort to the buildscript we had in my previous &lt;a href=&quot;/blog/2015/08/06/artifactory/&quot;&gt;blogpost&lt;/a&gt;. At compile time the &lt;code&gt;Guava&lt;/code&gt; dependency will not be included, because the would make the library unnecessarily large. Instead, the compiler will tell the library: &amp;quot;don&amp;#39;t worry about this dependency, the app will provide it for you.&amp;quot;&lt;/p&gt;

&lt;p&gt;The app on the other hand wouldn&amp;#39;t have a clue which dependencies the library actually needs (how would it?) and hence the app will compile just fine. However, after starting the app and trying to access the library, the app would crash at runtime:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-Java&quot; data-lang=&quot;Java&quot;&gt;&lt;span class=&quot;mi&quot;&gt;08&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;09&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;49&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;46.096&lt;/span&gt;  &lt;span class=&quot;mi&quot;&gt;28892&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;28892&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/?&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;E&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AndroidRuntime&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;ï¹•&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FATAL&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;EXCEPTION:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;
&lt;span class=&quot;nl&quot;&gt;Process:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;com&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;jeroenmols&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;awesomeadvancedapplication&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;PID:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;28892&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;java&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;lang&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;NoClassDefFoundError&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Failed&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;resolution&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;of:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Lcom&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;google&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;common&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;base&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CharMatcher&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;at&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;com&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;jeroenmols&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;awesomeadvancedlibrary&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;AwesomeConvertor&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;toAwesome&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AwesomeConvertor&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;java&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;11&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;To solve this, we need to ensure that the library &lt;code&gt;pom.xml&lt;/code&gt; file  contains the right dependencies by manually adding the &lt;code&gt;pom.withXml{}&lt;/code&gt; element to the &lt;code&gt;publishing task&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-groovy&quot; data-lang=&quot;groovy&quot;&gt;&lt;span class=&quot;n&quot;&gt;publishing&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;publications&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;aar&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;MavenPublication&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;groupId&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;packageName&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;version&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;libraryVersion&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;artifactId&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;project&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;artifact&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;$buildDir/outputs/aar/${project.getName()}-release.aar&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

            &lt;span class=&quot;n&quot;&gt;pom&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;withXml&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;kt&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dependencies&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;asNode&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;appendNode&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;dependencies&amp;#39;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;configurations&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getByName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;_releaseCompile&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getResolvedConfiguration&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getFirstLevelModuleDependencies&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;each&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;kt&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dependency&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dependencies&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;appendNode&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;dependency&amp;#39;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;dependency&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;appendNode&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;groupId&amp;#39;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;moduleGroup&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;dependency&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;appendNode&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;artifactId&amp;#39;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;moduleName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;dependency&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;appendNode&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;version&amp;#39;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;moduleVersion&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Note that while you can similarly add other repositories in this way to the &lt;code&gt;pom.xml&lt;/code&gt;, Gradle itself &lt;a href=&quot;https://discuss.gradle.org/t/resolving-problem-when-maven-repo-contains-pom-but-not-jar/7174&quot;&gt;won&amp;#39;t look&lt;/a&gt; for repositories in that file. Therefore if you use libraries from 3rd party repositories, you still need to add those repositories to the &lt;code&gt;build.gradle&lt;/code&gt; of your app.&lt;/p&gt;

&lt;h2&gt;Securely provide username and password&lt;/h2&gt;

&lt;p&gt;Obviously we do not want to store a plain text username and password in any file that we check in to our version control system. So to make sure we hide those, create a &lt;code&gt;gradle.properties&lt;/code&gt; file in the root of your project and add the following content:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-groovy&quot; data-lang=&quot;groovy&quot;&gt;&lt;span class=&quot;n&quot;&gt;artifactory_username&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;admin&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;artifactory_password&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;password&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then in your &lt;code&gt;build.gradle&lt;/code&gt; file, refer to the properties like this:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-groovy&quot; data-lang=&quot;groovy&quot;&gt;&lt;span class=&quot;n&quot;&gt;username&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;artifactory_username&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;password&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;artifactory_password&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We have now obfuscated the password, so it is no longer in the &lt;code&gt;build.gradle&lt;/code&gt; file, but people can still find it in the &lt;code&gt;gradle.properties&lt;/code&gt; file under version control. To prevent this, you must do one of the following:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Don&amp;#39;t add &lt;code&gt;gradle.properties&lt;/code&gt; to your version control system. (add it to your &lt;code&gt;.gitignore&lt;/code&gt; file instead)&lt;/li&gt;
&lt;li&gt;Move the &lt;code&gt;gradle.properties&lt;/code&gt; to the base &lt;code&gt;~/.gradle&lt;/code&gt; folder on your hard drive. I personally recommend this approach as you can never accidentally check in your username and password.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;Working with Snapshot and Release builds&lt;/h2&gt;

&lt;p&gt;While the Artifactory Gradle plugin doesn&amp;#39;t have support for snapshot/release builds out of the box, it is easy to add this functionality by relying on the artifact version:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;For release builds: use &lt;a href=&quot;http://semver.org/&quot;&gt;symantic versioning&lt;/a&gt; e.g. &lt;code&gt;1.0.0&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;For Snapshot builds: use symantic versioning with &lt;code&gt;-SNAPSHOT&lt;/code&gt; suffix e.g. &lt;code&gt;1.0.0-SNAPSHOT&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Now you can direct each one to a different Artifactory repository by changing the repository key as follows:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-groovy&quot; data-lang=&quot;groovy&quot;&gt;&lt;span class=&quot;n&quot;&gt;repoKey&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;libraryVersion&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;endsWith&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;SNAPSHOT&amp;#39;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;libs-snapshot-local&amp;#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;libs-release-local&amp;#39;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;On the application side you need to add two different Maven urls so you can refer to artifacts in both repositories.&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-groovy&quot; data-lang=&quot;groovy&quot;&gt;&lt;span class=&quot;n&quot;&gt;allprojects&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;repositories&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;maven&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;url&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;http://localhost:8081/artifactory/libs-release-local&amp;quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;maven&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;url&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;http://localhost:8081/artifactory/libs-snapshot-local&amp;quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Referencing artifacts is exactly the same as before, just don&amp;#39;t forget to add the &lt;code&gt;-SNAPSHOT&lt;/code&gt; suffix for snapshot artifacts.&lt;/p&gt;

&lt;p&gt;Alternatively we can also create a &lt;code&gt;virtual&lt;/code&gt; repository in Artifactory which wraps around both repositories. This way the app only requires one URL, but does create a dependency on the existing Artifactory setup.&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;Login to Artifactory and go to admin &amp;gt; repositories &amp;gt; virtual
&lt;center&gt;&lt;a href=&quot;/img/blog/artifactory2/artifactory2_virtualrepo1.png&quot;&gt;&lt;img src=&quot;/img/blog/artifactory2/artifactory2_virtualrepo1.png&quot; alt=&quot;All virtual repositories can be found under admin - repositories - virtual&quot;&gt;&lt;/a&gt;&lt;/center&gt;&lt;/li&gt;
&lt;li&gt;Create a new virtual maven repository which contains both &lt;code&gt;libs-release-local&lt;/code&gt; and &lt;code&gt;libs-snapshot-local&lt;/code&gt;
&lt;center&gt;&lt;a href=&quot;/img/blog/artifactory2/artifactory2_virtualrepo2.png&quot;&gt;&lt;img src=&quot;/img/blog/artifactory2/artifactory2_virtualrepo2.png&quot; alt=&quot;Create a new virtual maven repository which contains both libs-release-local and libs-snapshot-local&quot;&gt;&lt;/a&gt;&lt;/center&gt;&lt;/li&gt;
&lt;li&gt;In the top level &lt;code&gt;build.gradle&lt;/code&gt; of your application, replace the two previous URLS by the following:&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-groovy&quot; data-lang=&quot;groovy&quot;&gt;  &lt;span class=&quot;n&quot;&gt;allprojects&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;repositories&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;maven&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;url&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;http://localhost:8081/artifactory/libs-local&amp;quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;User access management&lt;/h2&gt;

&lt;p&gt;Currently everyone can both read and write to all your repositories. This is not a good idea, especially if your server is also connected to the internet. Therefore we are going to set up two different users: one to deploy artifacts and one to consume artifacts.&lt;/p&gt;

&lt;p&gt;In order to do so, go to artifactory and login as &lt;code&gt;admin&lt;/code&gt;. Now navigate to admin &amp;gt; security &amp;gt; general and make the following changes:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;set &lt;code&gt;Allow Anonymous Access&lt;/code&gt; to false -&amp;gt; ensures only known Artifactory users can consume artifacts&lt;/li&gt;
&lt;li&gt;set &lt;code&gt;Password Encryption Policy&lt;/code&gt; to &lt;code&gt;REQUIRED&lt;/code&gt; -&amp;gt; ensures we don&amp;#39;t have to hardcode a plain text password in our &lt;code&gt;build.gradle&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;press the &lt;code&gt;encrypt&lt;/code&gt; button in the &lt;code&gt;Password Encyption&lt;/code&gt; section -&amp;gt; encrypts all passwords&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;If the app now tries to consume an artifact, it will get a &lt;code&gt;401&lt;/code&gt; error: unauthorized. You can verify this yourself by clearing the gradle cache (to force a dependency download):&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;gradle clean --refresh-dependencies
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Next, go to the &lt;code&gt;Users&lt;/code&gt; pane and add two new user: &lt;code&gt;consumer&lt;/code&gt; and &lt;code&gt;deployer&lt;/code&gt;. Make sure not to add them to any group.&lt;/p&gt;

&lt;p&gt;&lt;center&gt;&lt;a href=&quot;/img/blog/artifactory2/artifactory2_user1.png&quot;&gt;&lt;img src=&quot;/img/blog/artifactory2/artifactory2_user1.png&quot; alt=&quot;Settings for consumer user&quot;&gt;&lt;/a&gt;&lt;/center&gt;&lt;/p&gt;

&lt;p&gt;&lt;center&gt;&lt;a href=&quot;/img/blog/artifactory2/artifactory2_user2.png&quot;&gt;&lt;img src=&quot;/img/blog/artifactory2/artifactory2_user2.png&quot; alt=&quot;Settings for deployer user&quot;&gt;&lt;/a&gt;&lt;/center&gt;&lt;/p&gt;

&lt;p&gt;Note that you probably also want to change your admin password at this stage. ;)&lt;/p&gt;

&lt;p&gt;Now go to the &lt;code&gt;Permissions&lt;/code&gt; pane and add a new &lt;code&gt;Consume Libraries&lt;/code&gt; permission. Set the Selected repositories to include the snapshot and release repository, and in the &lt;code&gt;Users&lt;/code&gt; tab add the &lt;code&gt;consumer&lt;/code&gt; user with read permissions.&lt;/p&gt;

&lt;p&gt;&lt;center&gt;&lt;a href=&quot;/img/blog/artifactory2/artifactory2_permission1.png&quot;&gt;&lt;img src=&quot;/img/blog/artifactory2/artifactory2_permission1.png&quot; alt=&quot;Settings for Consume Libraries permission&quot;&gt;&lt;/a&gt;&lt;/center&gt;&lt;/p&gt;

&lt;p&gt;&lt;center&gt;&lt;a href=&quot;/img/blog/artifactory2/artifactory2_permission2.png&quot;&gt;&lt;img src=&quot;/img/blog/artifactory2/artifactory2_permission2.png&quot; alt=&quot;Settings for Consume Libraries permission&quot;&gt;&lt;/a&gt;&lt;/center&gt;&lt;/p&gt;

&lt;p&gt;Add a second permission: &lt;code&gt;Deploy Libraries&lt;/code&gt; with the snapshot and release repository included. Here give the &lt;code&gt;deployer&lt;/code&gt; user &lt;code&gt;Deploy/Cache&lt;/code&gt; permission but not &lt;code&gt;Delete/Overwrite&lt;/code&gt; as you never want to override an existing artifact!&lt;/p&gt;

&lt;p&gt;&lt;center&gt;&lt;a href=&quot;/img/blog/artifactory2/artifactory2_permission3.png&quot;&gt;&lt;img src=&quot;/img/blog/artifactory2/artifactory2_permission3.png&quot; alt=&quot;Settings for Deploy Libraries permission&quot;&gt;&lt;/a&gt;&lt;/center&gt;&lt;/p&gt;

&lt;p&gt;&lt;center&gt;&lt;a href=&quot;/img/blog/artifactory2/artifactory2_permission4.png&quot;&gt;&lt;img src=&quot;/img/blog/artifactory2/artifactory2_permission4.png&quot; alt=&quot;Settings for Deploy Libraries permission&quot;&gt;&lt;/a&gt;&lt;/center&gt;&lt;/p&gt;

&lt;p&gt;All we need to do now is modify the Library and Application to make use of these new users. This is easy for the Library as you can simply replace the &lt;code&gt;admin&lt;/code&gt; user with the &lt;code&gt;deploy&lt;/code&gt; user in the &lt;code&gt;gradle.properties&lt;/code&gt; file.&lt;/p&gt;

&lt;p&gt;For the Application we will need to provide credentials to access the Maven repository. Here we will hard code the username and password in the top level &lt;code&gt;build.gradle&lt;/code&gt; file because team members should be able to checkout and build the code without extra configuration.&lt;/p&gt;

&lt;p&gt;Therefore we will take some extra security precautions:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Use a user with read access to only a small subset of our repositories: &lt;code&gt;deploy&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Check the code into a private repository, so the hardcoded password is protected by repository password.&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Use the encrypted version of the password instead of the plain text version:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Login to artifactory as the &lt;code&gt;consumer&lt;/code&gt; user&lt;/li&gt;
&lt;li&gt;Navigate to the user settings in the top right corner&lt;/li&gt;
&lt;li&gt;Unlock your profile with your password&lt;/li&gt;
&lt;li&gt;Copy the API key&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;center&gt;&lt;a href=&quot;/img/blog/artifactory2/artifactory2_consumer.png&quot;&gt;&lt;img src=&quot;/img/blog/artifactory2/artifactory2_consumer.png&quot; alt=&quot;Copy the API key from the consumer profile.&quot;&gt;&lt;/a&gt;&lt;/center&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Now add the user authentication to the top level &lt;code&gt;build.gradle&lt;/code&gt; file:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-Groovy&quot; data-lang=&quot;Groovy&quot;&gt;&lt;span class=&quot;n&quot;&gt;allprojects&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;repositories&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;jcenter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// NOTE: configure your virtual repository and user in artifactory to make this work&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;maven&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;url&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;http://localhost:8081/artifactory/libs-local&amp;quot;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;credentials&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;username&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;consumer&amp;#39;&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;password&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;APA52uxnRkmxeRXmJqd7haMpwgg&amp;#39;&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;And we are all set with authenticated access to our repositories.&lt;/p&gt;

&lt;h2&gt;Wrap-up&lt;/h2&gt;

&lt;p&gt;That&amp;#39;s a wrap to my two part blogpost about Artifactory! We made our previous repository a lot more secure, added support for dependencies and can now differentiate between release and snapshot artifacts.&lt;/p&gt;

&lt;p&gt;No more excuses not to write reusable code!&lt;/p&gt;

&lt;p&gt;Feel free to leave a comment and don&amp;#39;t forget to check the &lt;a href=&quot;https://github.com/JeroenMols/ArtifactoryExample&quot;&gt;full source code&lt;/a&gt; on Github.&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>A private Maven repository for Android in 30 min</title>
   <link href="jeroenmols.github.io/blog/2015/08/06/artifactory/"/>
   <updated>2015-08-06T00:00:00+02:00</updated>
   <id>jeroenmols.github.io/blog/2015/08/06/artifactory</id>
   <content type="html">&lt;p&gt;Setting up your own Maven repository and uploading artifacts to it is quite a daunting task. As I went through this experience myself recently, I want to help others in setting up their own Maven repository via &lt;a href=&quot;http://www.jfrog.com/open-source/&quot;&gt;Artifactory&lt;/a&gt; and automate uploading artifacts using Gradle.&lt;/p&gt;

&lt;p&gt;In less than 30 minutes you will have a fully operational private Maven repository and have configured your Gradle buildscripts to upload your Android library artifacts.&lt;/p&gt;

&lt;p&gt;Note that the material presented here can quite easily be extended to be applicable in a broader scope beyond Android.&lt;/p&gt;

&lt;h2&gt;Setting up a Repository Manager&lt;/h2&gt;

&lt;p&gt;First of all we need to make sure we have an actual Maven repository to upload our artifacts to. According to &lt;a href=&quot;https://maven.apache.org/repository-management.html&quot;&gt;Maven&lt;/a&gt; you should use a repository manager to do that:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Best Practice - Using a Repository Manager&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;A repository manager is a dedicated server application designed to manage repositories of binary components. The usage of a repository manager is considered an essential best practice for any significant usage of Maven.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3&gt;Why Artifactory?&lt;/h3&gt;

&lt;p&gt;While there are some options available to choose from, I personally selected &lt;a href=&quot;http://www.jfrog.com/open-source/&quot;&gt;Artifactory&lt;/a&gt; because:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Clear and attractive UI&lt;/li&gt;
&lt;li&gt;Super fast configuration&lt;/li&gt;
&lt;li&gt;Gradle plugin&lt;/li&gt;
&lt;li&gt;User access control&lt;/li&gt;
&lt;li&gt;Free and open source&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;center&gt;&lt;a href=&quot;http://www.youtube.com/watch?v=aa4YBDUDWy0&quot;&gt;&lt;img src=&quot;http://img.youtube.com/vi/aa4YBDUDWy0/0.jpg&quot; alt=&quot;What is Artifactory&quot;&gt;&lt;/a&gt;&lt;/center&gt;&lt;/p&gt;&lt;/p&gt;

&lt;p&gt;For more information have a look at the &lt;a href=&quot;https://maven.apache.org/repository-management.html&quot;&gt;alternatives&lt;/a&gt;, checkout this &lt;a href=&quot;http://www.jfrog.com/blog/artifactory-vs-nexus-integration-matrix/&quot;&gt;feature comparison matrix&lt;/a&gt; or review all of the &lt;a href=&quot;https://www.jfrog.com/confluence/display/RTF/Artifactory+Comparison+Matrix&quot;&gt;Artifactory features&lt;/a&gt;.&lt;/p&gt;

&lt;h3&gt;Verify you have Java SDK 8&lt;/h3&gt;

&lt;p&gt;Before you get started, make sure that you have Java SDK 8 installed, or otherwise Artifactory won&amp;#39;t start. You can easily verify your Java version with &lt;code&gt;java -version&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;java -version
java version &lt;span class=&quot;s2&quot;&gt;&amp;quot;1.8.0_51&amp;quot;&lt;/span&gt;
Java&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;TM&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; SE Runtime Environment &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;build 1.8.0_51-b16&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Java HotSpot&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;TM&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; 64-Bit Server VM &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;build 25.51-b03, mixed mode&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If it doesn&amp;#39;t output at least version &lt;code&gt;1.8.x&lt;/code&gt;, you should &lt;a href=&quot;http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html&quot;&gt;download&lt;/a&gt; and install a new Java SDK before you continue.&lt;/p&gt;

&lt;p&gt;Note that the error you get if you don&amp;#39;t have Java 8 looks a bit cryptic:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;Aug 05, 2015 9:29:31 AM org.apache.catalina.core.StandardContext startInternal
SEVERE: One or more listeners failed to start. Full details will be found in the appropriate container log file
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Install Artifactory&lt;/h3&gt;

&lt;p&gt;Thankfully this is incredibly easy to do. Just download the latest version of &lt;a href=&quot;http://www.jfrog.com/open-source/&quot;&gt;Artifactory&lt;/a&gt;, unpack the archive and run the &lt;code&gt;artifactory&lt;/code&gt; executable for your platform.&lt;/p&gt;

&lt;p&gt;&lt;center&gt;&lt;a href=&quot;http://www.youtube.com/watch?v=7ZSUHgHDMmc&quot;&gt;&lt;img src=&quot;http://img.youtube.com/vi/7ZSUHgHDMmc/0.jpg&quot; alt=&quot;&amp;lt; 1min Artifactory set up&quot;&gt;&lt;/a&gt;&lt;/center&gt;&lt;/p&gt;&lt;/p&gt;

&lt;p&gt;You can easily verify your installation and start experimenting with its features by navigating to &lt;a href=&quot;http://localhost:8081/artifactory/&quot;&gt;http://localhost:8081/artifactory/&lt;/a&gt;. For now, don&amp;#39;t worry about all of the settings, we will configure what we need later on.&lt;/p&gt;

&lt;h3&gt;Configuring Gradle to upload Android artifacts&lt;/h3&gt;

&lt;p&gt;Let&amp;#39;s upload a very simple archive by configuring a new Gradle task for our Android library project.&lt;/p&gt;

&lt;p&gt;In your top level &lt;code&gt;build.gradle&lt;/code&gt; file, add a reference to the repository of the Artifactory Gradle plugin:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-groovy&quot; data-lang=&quot;groovy&quot;&gt;&lt;span class=&quot;n&quot;&gt;buildscript&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;dependencies&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;classpath&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;org.jfrog.buildinfo:build-info-extractor-gradle:3.1.1&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Next in your library we will need to apply two new plugins: one to prepare the Maven artifacts &lt;code&gt;maven-publish&lt;/code&gt; and one to upload the archives to Artifactory &lt;code&gt;com.jfrog.artifactory&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-groovy&quot; data-lang=&quot;groovy&quot;&gt;&lt;span class=&quot;n&quot;&gt;apply&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;plugin:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;com.jfrog.artifactory&amp;#39;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;apply&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;plugin:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;maven-publish&amp;#39;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Every Maven artifact is identified by three different parameters:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;artifactId: the name of your library&lt;/li&gt;
&lt;li&gt;groupId: usually the package name of your library&lt;/li&gt;
&lt;li&gt;version: identifies different releases of the same artifact&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;For the last two, we will explicitly define a variable in the &lt;code&gt;build.gradle&lt;/code&gt; file.&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-groovy&quot; data-lang=&quot;groovy&quot;&gt;&lt;span class=&quot;kt&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;packageName&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;com.jeroenmols.awesomelibrary&amp;#39;&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;libraryVersion&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;1.0.0&amp;#39;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The &lt;code&gt;artifactId&lt;/code&gt; however needs to match the output filename of the &lt;code&gt;assembleRelease&lt;/code&gt; task. Therefore we either have to &lt;a href=&quot;https://stackoverflow.com/questions/26936812/renaming-modules-in-android-studio&quot;&gt;rename the library module&lt;/a&gt; or explicitly &lt;a href=&quot;https://stackoverflow.com/questions/24728591/how-to-set-name-of-aar-output-from-gradle&quot;&gt;specify the output filename&lt;/a&gt;. I personally prefer the first approach, which allows to get &lt;code&gt;artifactId&lt;/code&gt; in the following way:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-groovy&quot; data-lang=&quot;groovy&quot;&gt;&lt;span class=&quot;n&quot;&gt;project&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// the ArtifactId&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now we need to configure the &lt;code&gt;maven-publish&lt;/code&gt; plugin so that it knows which artifacts to publish to Artifactory. For our purpose we will refer to the &lt;code&gt;***-release.aar&lt;/code&gt; file, generated by the &lt;code&gt;assembleRelease&lt;/code&gt; task. Note that we can predict the name by taking the name of the Library project:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-groovy&quot; data-lang=&quot;groovy&quot;&gt;&lt;span class=&quot;n&quot;&gt;publishing&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;publications&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;aar&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;MavenPublication&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;groupId&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;packageName&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;version&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;libraryVersion&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;artifactId&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;project&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;

            &lt;span class=&quot;c1&quot;&gt;// Tell maven to prepare the generated &amp;quot;*.aar&amp;quot; file for publishing&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;artifact&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;$buildDir/outputs/aar/${project.getName()}-release.aar&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Finally we need to configure the &lt;code&gt;com.jfrog.artifactory&lt;/code&gt; plugin so it knows which repository to publish the artifacts to. For simplicity we will upload the artifact to the locally running Artifactory instance (&lt;a href=&quot;http://localhost:8081/artifactory&quot;&gt;http://localhost:8081/artifactory&lt;/a&gt;) and place it in the default &lt;code&gt;libs-release-local&lt;/code&gt; repository. Note that the username &lt;code&gt;admin&lt;/code&gt; and password &lt;code&gt;password&lt;/code&gt; are hardcoded in this example, but we will provide a better solution for that later.&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-groovy&quot; data-lang=&quot;groovy&quot;&gt;&lt;span class=&quot;n&quot;&gt;artifactory&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;contextUrl&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;http://localhost:8081/artifactory&amp;#39;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;publish&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;repository&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;// The Artifactory repository key to publish to&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;repoKey&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;libs-release-local&amp;#39;&lt;/span&gt;

            &lt;span class=&quot;n&quot;&gt;username&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;password&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;password&amp;quot;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;defaults&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;// Tell the Artifactory Plugin which artifacts should be published to Artifactory.&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;publications&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;aar&amp;#39;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;publishArtifacts&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;

            &lt;span class=&quot;c1&quot;&gt;// Properties to be attached to the published artifacts.&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;properties&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;qa.level&amp;#39;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;basic&amp;#39;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;dev.team&amp;#39;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;core&amp;#39;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;// Publish generated POM files to Artifactory (true by default)&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;publishPom&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Deploying artifacts&lt;/h3&gt;

&lt;p&gt;Now that our Gradle buildscripts are properly configured we can easily publish artifacts to Artifactory by running the following command:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-groovy&quot; data-lang=&quot;groovy&quot;&gt;&lt;span class=&quot;n&quot;&gt;gradle&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;assembleRelease&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;artifactoryPublish&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Notice how we first invoke &lt;code&gt;assembleRelease&lt;/code&gt; before we invoke the actual &lt;code&gt;artifactoryPublish&lt;/code&gt; task, because of the way we defined the artifacts to publish in the previous section.&lt;/p&gt;

&lt;p&gt;You can very easily verify that the upload was successful by navigating to &lt;a href=&quot;http://localhost:8081&quot;&gt;localhost:8081&lt;/a&gt; and signing in with the default admin credentials.&lt;/p&gt;

&lt;p&gt;&lt;center&gt;&lt;a href=&quot;/img/blog/artifactory/artifactory_screenshot.png&quot;&gt;&lt;img src=&quot;/img/blog/artifactory/artifactory_screenshot.png&quot; alt=&quot;Verify a successful upload in the Artifactory control panel.&quot;&gt;&lt;/a&gt;&lt;/center&gt;&lt;/p&gt;

&lt;h3&gt;Using the artifacts&lt;/h3&gt;

&lt;p&gt;To make use of the published artifacts in another project we have to add our Artifactory repository to the list of Maven repositories in your top level &lt;code&gt;build.gradle&lt;/code&gt; file:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-groovy&quot; data-lang=&quot;groovy&quot;&gt;&lt;span class=&quot;n&quot;&gt;allprojects&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;repositories&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;maven&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;url&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;http://localhost:8081/artifactory/libs-release-local&amp;quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;After we can simply add the artifact as a dependency in the &lt;code&gt;build.gradle&lt;/code&gt; file of our main project:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-groovy&quot; data-lang=&quot;groovy&quot;&gt;&lt;span class=&quot;n&quot;&gt;dependencies&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;compile&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;com.jeroenmols.awesomelibrary:1.0.0&amp;#39;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Wrap-up&lt;/h2&gt;

&lt;p&gt;Congratulations! You now have a fully working Maven repository manager with a Gradle script to generate and upload your artifacts.&lt;/p&gt;

&lt;p&gt;In the next &lt;a href=&quot;/blog/2015/08/13/artifactory2/&quot;&gt;blog post&lt;/a&gt; I will zoom in on more advanced topics like:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Library projects with dependencies&lt;/li&gt;
&lt;li&gt;Configuring your own repositories&lt;/li&gt;
&lt;li&gt;User access management and rights&lt;/li&gt;
&lt;li&gt;Removing hardcoded username and password from &lt;code&gt;build.gradle&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;I have also uploaded a &lt;a href=&quot;https://github.com/JeroenMols/ArtifactoryExample&quot;&gt;complete example&lt;/a&gt; on GitHub for your reference.&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>How I created my blog</title>
   <link href="jeroenmols.github.io/blog/2015/04/25/blog-creation/"/>
   <updated>2015-04-25T00:00:00+02:00</updated>
   <id>jeroenmols.github.io/blog/2015/04/25/blog-creation</id>
   <content type="html">&lt;h2&gt;Preface&lt;/h2&gt;

&lt;p&gt;For quite some months, I&amp;#39;ve been planning to create a website and start blogging about the things I&amp;#39;m passionate about. Last week, I finally decided to setup a &lt;a href=&quot;http://jeroenmols.github.io&quot;&gt;portfolio&lt;/a&gt; and &lt;a href=&quot;http://jeroen.mols.github.io/blog&quot;&gt;blog&lt;/a&gt; using GitHub pages and Jekyll.&lt;/p&gt;

&lt;p&gt;Since I&amp;#39;m an Android and not a web developer, the first blogging subject wasn&amp;#39;t hard to find: challenges I came across in setting up this website and blog.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Disclaimer:&lt;/strong&gt; Eventually I had to use a workaround - that&amp;#39;s why I don&amp;#39;t build websites professionally - but I strongly believe in a &lt;em&gt;Just do It&lt;/em&gt; mentality and then learn/improve as you go.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2&gt;Why Jekyll&lt;/h2&gt;

&lt;p&gt;Keeping it simple, I only had few requirements for my blog:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Responsive website&lt;/li&gt;
&lt;li&gt;Easy to setup and maintain&lt;/li&gt;
&lt;li&gt;No lock-in: able to migrate to other platforms&lt;/li&gt;
&lt;li&gt;Support for pagination and comments&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;First thing I learned was the difference between a static (e.g. Jekyll) and dynamic website (e.g. Wordpress) via a &lt;a href=&quot;http://nilclass.com/courses/what-is-a-static-website/&quot;&gt;great presentation&lt;/a&gt; by &lt;a href=&quot;https://twitter.com/plusjade&quot;&gt;@plusjade&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The main advantage of static websites is their loading speed because all pages are generated before they are served. Installing the generator on your local machine is simple, making it easy to test your site before deploying online. Posts are written in Markdown, so no HTML clutter nor extra tools needed. Just a text generator and Git to conveniently version all changes.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Protip:&lt;/strong&gt; One of my colleagues &lt;a href=&quot;https://twitter.com/inferis&quot;&gt;@inferis&lt;/a&gt; even gets spelling corrections via Pull request!&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;As GitHub pages natively supports Jekyll, I didn&amp;#39;t really spent much time on choosing which &lt;a href=&quot;https://staticsitegenerators.net/&quot;&gt;static site generator&lt;/a&gt; to use.&lt;/p&gt;

&lt;h2&gt;Setting up&lt;/h2&gt;

&lt;p&gt;Installing Jekyll was really a breeze, I just had to run &lt;code&gt;gem install Jekyll&lt;/code&gt; and then I could build my website using &lt;code&gt;jekyll build&lt;/code&gt; or test it locally using &lt;code&gt;jekyll serve&lt;/code&gt;.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; both commands will generate your website in the &lt;code&gt;_site&lt;/code&gt; folder, which you shouldn&amp;#39;t add to version control!&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Instead of making a new Jekyll site, I decided to fork two existing themes:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://hyde.getpoole.com/&quot;&gt;Hyde&lt;/a&gt;: a clean two-column theme for my Blog&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://startbootstrap.com/template-overviews/freelancer/&quot;&gt;Freelancer&lt;/a&gt;: to have a cool portfolio&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Both themes offer quite some predefined customization options via the &lt;code&gt;_config.yml&lt;/code&gt; file, but for advanced theming you can also directly edit the CSS files.&lt;/p&gt;

&lt;h2&gt;Merging two Jekyll themes&lt;/h2&gt;

&lt;p&gt;Where I originally only wanted to have a blog, the Freelancer theme was just too cool to ignore. Consequently merging two themes was one of the first things I had to do.&lt;/p&gt;

&lt;p&gt;It seemed most convenient to have my portfolio under my main url and to include my blog under a subfolder (i.e. &lt;code&gt;jeroenmols.github.io/blog&lt;/code&gt;).&lt;/p&gt;

&lt;p&gt;To do this I merged the blog theme into the portfolio (main) theme:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Add a subfolder &lt;code&gt;blog/&lt;/code&gt; with the &lt;code&gt;index.html&lt;/code&gt; of my blog.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Move all my portfolio posts and blog posts into separate folders:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;all portfolio posts went into &lt;code&gt;portfolio/_posts&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;all blog posts went into &lt;code&gt;blog/_posts&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This allows to easily loop through all portfolio or blog posts separately:
- &lt;code&gt;{% for post in site.categories.portfolio %}&lt;/code&gt;
- &lt;code&gt;{% for post in site.categories.blog %}&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Move all files in &lt;code&gt;_layouts&lt;/code&gt; and &lt;code&gt;_includes&lt;/code&gt; from my blog into the corresponding folders of my portfolio theme.&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Optionally you can move files into subfolders to keep things clean (&lt;code&gt;_includes/blog&lt;/code&gt;), as long as you also update all references to these files. (in &lt;code&gt;_layouts/blog.html&lt;/code&gt; I now refer to my includes as &lt;code&gt;blog/&amp;lt;original name&amp;gt;&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;Same holds true if you have naming conflicts (for instance two layouts with the same name), you can just rename one and update all references in all files using it.&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Move all other folders and files into the root of the main theme&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Merge the configurations from both &lt;code&gt;_config.yml&lt;/code&gt; files&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Again you can rename conflicting configurations (or merge duplicate ones) if you update all references.&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Fix all references to not found images/css/... files in the blog theme. This is necessary because the original theme was assuming to run in the root directory, and now we moved it to a subdirectory &lt;code&gt;blog/&lt;/code&gt;.&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;I found that the best way to do this is to run &lt;code&gt;jekyll build&lt;/code&gt; and have a look at the generated output in the &lt;code&gt;_site&lt;/code&gt; directory. From this you can learn what&amp;#39;s wrong and fix it.&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;After this I could run &lt;code&gt;Jekyll serve&lt;/code&gt; and everything worked flawlessly!&lt;/p&gt;

&lt;p&gt;...&lt;/p&gt;

&lt;p&gt;Wait...&lt;/p&gt;

&lt;p&gt;...&lt;/p&gt;

&lt;p&gt;Why are my portfolio posts also showing up in my blog?&lt;/p&gt;

&lt;p&gt;...&lt;/p&gt;

&lt;p&gt;Damn you Jekyll!&lt;/p&gt;

&lt;p&gt;Turns out Jekyll does not support paginating categories and hence it will lump all posts it finds together, in my case both portfolio (unwanted) and blog (wanted). Even more, there is no plugin to add this functionality either! Pretty weird, and a huge limitation if you ask me.&lt;/p&gt;

&lt;p&gt;So I did what every self-respecting programmer would do: pray to the Stackoverflow and GitHub gods. And my prayers where answered by a code snippet of &lt;a href=&quot;https://github.com/benxtan&quot;&gt;benxtan&lt;/a&gt;, which I found in an issue tracker of a very old &lt;a href=&quot;https://github.com/Painted-Fox/jekyll-category-pagination/issues/6&quot;&gt;Jekyll pagination plugin&lt;/a&gt;. To enable this plugin, simply create a &lt;code&gt;_plugins&lt;/code&gt; folder and copy the code snippet into a &lt;code&gt;category_pagination.rb&lt;/code&gt; file.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Note&lt;/strong&gt;: the former plugin was no longer working, because it was referring to classes that were renamed/moved classes in newer Jekyll versions.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2&gt;GitHub and Jekyll plugins&lt;/h2&gt;

&lt;p&gt;My new shiny portfolio and blog were working locally, but when I pushed it to GitHub, the pagination again included both blog and portfolio posts. Turns out that GitHub doesn&amp;#39;t allow you to run custom Jekyll plugins except for a few that they have whitelisted.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;&lt;a href=&quot;http://jekyllrb.com/docs/plugins/&quot;&gt;Plugins on GitHub Pages&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;GitHub Pages is powered by Jekyll. However, all Pages sites are generated using the --safe option to disable custom plugins for security reasons. Unfortunately, this means your plugins wonâ€™t work if youâ€™re deploying to GitHub Pages.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;At this point, I am/was completely stuck, because even if Jekyll would add support for category pagination, I would still need to wait for GitHub to update their Jekyll version.&lt;/p&gt;

&lt;p&gt;Only option remaining was to directly push the generated &lt;code&gt;_site&lt;/code&gt; directory into my repository and to disable the Jekyll generator on GitHub pages.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Note that this is a really suboptimal solution, because this effectively means pushing a high amount of auto-generated files to your repo, frequently. So if anyone has a better suggestion to solve the pagination issue, please let me know!&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;To make this work, there are a couple of things you need to do:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Disable Jekyll on GitHub pages by pushing an empty file with name &lt;code&gt;.nojekyll&lt;/code&gt; to the root of your repo&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Move all auto generated content from the &lt;code&gt;_site&lt;/code&gt; folder into the root of your repository, so that its &lt;code&gt;index.html&lt;/code&gt; is displayed when someone browses to your main page.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This actually by itself imposes a new problem, namely where to put your Jekyll source code? I solved this by:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;move all source files to a subfolder &lt;code&gt;jekyll-source&lt;/code&gt; in my main repository&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;generating all static pages into &lt;code&gt;jekyll-source/_site&lt;/code&gt; using &lt;code&gt;jekyll build&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;removing all files and folders from my root directory, except for the &lt;code&gt;jekyll-source&lt;/code&gt; directory&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;copying the entire content of &lt;code&gt;jekyll-source/_site&lt;/code&gt; into my root folder&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;I know this is not a great solution, but it gets the job done, and I was able to automate all of this in a &lt;a href=&quot;https://github.com/JeroenMols/jeroenmols.github.io/blob/master/jekyll-code/release&quot;&gt;release script&lt;/a&gt; that you can run by calling &lt;code&gt;.release&lt;/code&gt; from the &lt;code&gt;jekyll-source&lt;/code&gt; folder.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Note&lt;/strong&gt;: I also considered two other options:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Use a &lt;code&gt;CNAME&lt;/code&gt; file to redirect my main url into a subfolder. This does not work, as the &lt;code&gt;CNAME&lt;/code&gt; file can only be used for top-level domains.&lt;/li&gt;
&lt;li&gt;Use a placeholder &lt;code&gt;index.html&lt;/code&gt; which redirect the main url into a subfolder.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;I didn&amp;#39;t use any of those mechanisms as that would unnecessarily complicate my website url.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2&gt;Protips&lt;/h2&gt;

&lt;p&gt;If you really want to make your site look spectacular:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Site icon: add the following to the head of your &lt;code&gt;index.html&lt;/code&gt; page:
&lt;code&gt;&amp;lt;link rel=&amp;quot;favicon-144-precomposed&amp;quot; sizes=&amp;quot;144x144&amp;quot; href=&amp;quot;&amp;lt;link_to_your_icon&amp;gt;&amp;quot;&amp;gt;&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Site toolbar/status bar color on Android: add the following to the head of your &lt;code&gt;index.html&lt;/code&gt; page: &lt;code&gt;&amp;lt;meta name=&amp;quot;theme-color&amp;quot; content=&amp;quot;&amp;lt;your_color_hex&amp;gt;&amp;quot;&amp;gt;&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;I&amp;#39;m glad that I finally got my portfolio and blog up and running. My current solution might not be the best one in the world, but it is automated, maintainable and I can easily add blog posts in the future. Don&amp;#39;t hesitate to look at my &lt;a href=&quot;https://github.com/JeroenMols/jeroenmols.github.io&quot;&gt;GitHub repo&lt;/a&gt; for the full source code. Hopefully the code and my post can help others to setup the same in the future.&lt;/p&gt;

&lt;p&gt;Would I use Jekyll again if I would start over? Probably yes.&lt;/p&gt;

&lt;p&gt;The only real limitation I ran into was due to the paginator combining the posts from both my portfolio and blog. This caused me to disable Jekyll completely and push the generated site directly to GitHub pages. While this really sucked, using another static site generator would also have forced me to do this (because GitHub only supports Jekyll). Furthermore combining two themes is already quite advanced, and if you stick to just one theme Jekyll is actually very convenient to use.&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>LandscapeVideoCamera</title>
   <link href="jeroenmols.github.io/portfolio/2015/01/19/landscapevideocamera/"/>
   <updated>2015-01-19T00:00:00+01:00</updated>
   <id>jeroenmols.github.io/portfolio/2015/01/19/landscapevideocamera</id>
   <content type="html"></content>
 </entry>
 
 <entry>
   <title>Saeco Avanti Espresso Machine</title>
   <link href="jeroenmols.github.io/portfolio/2014/12/03/saecoavanti/"/>
   <updated>2014-12-03T00:00:00+01:00</updated>
   <id>jeroenmols.github.io/portfolio/2014/12/03/saecoavanti</id>
   <content type="html"></content>
 </entry>
 
 <entry>
   <title>Lighting Point of Sale</title>
   <link href="jeroenmols.github.io/portfolio/2014/08/31/lightingpos/"/>
   <updated>2014-08-31T00:00:00+02:00</updated>
   <id>jeroenmols.github.io/portfolio/2014/08/31/lightingpos</id>
   <content type="html"></content>
 </entry>
 
 <entry>
   <title>Philips Smart Air</title>
   <link href="jeroenmols.github.io/portfolio/2014/06/28/smartair/"/>
   <updated>2014-06-28T00:00:00+02:00</updated>
   <id>jeroenmols.github.io/portfolio/2014/06/28/smartair</id>
   <content type="html"></content>
 </entry>
 
 <entry>
   <title>Event App Platform</title>
   <link href="jeroenmols.github.io/portfolio/2014/02/15/eventapp/"/>
   <updated>2014-02-15T00:00:00+01:00</updated>
   <id>jeroenmols.github.io/portfolio/2014/02/15/eventapp</id>
   <content type="html"></content>
 </entry>
 
 <entry>
   <title>Tomorrowland Radio</title>
   <link href="jeroenmols.github.io/portfolio/2013/12/10/tomorrowlandradio/"/>
   <updated>2013-12-10T00:00:00+01:00</updated>
   <id>jeroenmols.github.io/portfolio/2013/12/10/tomorrowlandradio</id>
   <content type="html"></content>
 </entry>
 
 <entry>
   <title>AirStudio+</title>
   <link href="jeroenmols.github.io/portfolio/2013/10/15/airstudio/"/>
   <updated>2013-10-15T00:00:00+02:00</updated>
   <id>jeroenmols.github.io/portfolio/2013/10/15/airstudio</id>
   <content type="html"></content>
 </entry>
 
 <entry>
   <title>Wi-FileTransfer</title>
   <link href="jeroenmols.github.io/portfolio/2013/04/01/wi-filetransfer/"/>
   <updated>2013-04-01T00:00:00+02:00</updated>
   <id>jeroenmols.github.io/portfolio/2013/04/01/wi-filetransfer</id>
   <content type="html"></content>
 </entry>
 
 <entry>
   <title>VideoBox</title>
   <link href="jeroenmols.github.io/portfolio/2010/09/25/videobox/"/>
   <updated>2010-09-25T00:00:00+02:00</updated>
   <id>jeroenmols.github.io/portfolio/2010/09/25/videobox</id>
   <content type="html"></content>
 </entry>
 

</feed>
